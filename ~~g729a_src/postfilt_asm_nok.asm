	.mmregs
FP	.set	AR7

	.bss	_res2_buf,183,0,0
	.bss	_res2,1,0,0
	.bss	_scal_res2_buf,183,0,0
	.bss	_scal_res2,1,0,0
	.bss	_mem_syn_pst,10,0,0
	

	.sect	".cinit"
	.align	1
	.field  	1,16
	.field  	_mem_pre$1+0,16
	.field  	0,16			; _mem_pre$1 @ 0

	.sect	".text"
	.bss	_mem_pre$1,1,0,0

	.sect	".cinit"
	.align	1
	.field  	1,16
	.field  	_past_gain$2+0,16
	.field  	4096,16			; _past_gain$2 @ 0

	.sect	".text"
	.bss	_past_gain$2,1,0,0

	.sect	".text"
	.global	_preemphasis
;----------------------------------------------------------------------
; 347 | void preemphasis(                                                      
; 348 | Word16 *signal,  /* (i/o)   : input signal overwritten by the output */
; 349 | Word16 g,        /* (i) Q15 : preemphasis coefficient                */
; 350 | Word16 L         /* (i)     : size of filtering                      */
; 351 | )                                                                      
;----------------------------------------------------------------------

_preemphasis:

        PSHM      AR1
        NOP
;----------------------------------------------------------------------
; 353 | static Word16 mem_pre = 0;                                             
; 354 | Word16 *p1, *p2, temp, i;                                              
; 356 | p1 = signal + L - 1;                                                   
;----------------------------------------------------------------------
        LD        *SP(3),B
        STLM      B,AR3
        NOP
        MVDK      *SP(2),*(AR2)

;----------------------------------------------------------------------
; 357 | p2 = p1 - 1;                                                           
;----------------------------------------------------------------------
        RSBX      OVM
        NOP
        ADD       A,B                   ; |357| 
        SUB       #1,B,A                ; |357| 
        STLM      A,AR1
        SUB       #1,A,A                ; |357| 
        STLM      A,AR4
        NOP

;----------------------------------------------------------------------
; 358 | temp = *p1;                                                            
;----------------------------------------------------------------------
        MVDK      *AR1,*(AR1)
;----------------------------------------------------------------------
; 360 | for (i = 0; i <= L-2; i++)                                             
;----------------------------------------------------------------------
        SSBX      SXM
        SSBX      OVM                   ; ****
        SSBX      FRCT                  ; ****
        NOP                             ; ****
        LDM       AR3,A
        LD        *(AL),A               ; |360| 
        SUB       #2,A,A                ; |360| 
        BC        L2,ALT                ; |360| 

        LDM       AR3,A
        SUB       #2,A,A
        STLM      A,BRC
        NOP
        RPTB      L2-1      
L1:    
;----------------------------------------------------------------------
; 362 | *p1-- = sub(*p1, mult(g, *p2--));                                      
;----------------------------------------------------------------------
        LD        *AR4,16,A             ; |362| 
        ;SSBX      FRCT
        ;SSBX      OVM
        MVMD      AR2,T
        MPYA      A                     ; |362| 
        ;RSBX      OVM
        LD        *AR4(1),16,B          ; |362| 
        ;SSBX      OVM
        SFTA      A,-16,A               ; |362| 
        SUB       *(AL),16,B,A          ; |362| 
        ;RSBX      OVM
        STH       A,*AR4(1)             ; |362| 
        MAR       *AR4-
L2:    
;----------------------------------------------------------------------
; 365 | *p1 = sub(*p1, mult(g, mem_pre));                                      
;----------------------------------------------------------------------
        LD        *(_mem_pre$1),16,A    ; |365| 
        ;SSBX      FRCT
        ;SSBX      OVM
        MVMD      AR2,T
        MPYA      A                     ; |365| 
        ;RSBX      OVM
        LD        *AR4(1),16,B          ; |365| 
        ;SSBX      OVM
        SFTA      A,-16,A               ; |365| 
        SUB       *(AL),16,B,A          ; |365| 
        STH       A,*AR4(1)             ; |365| 

;----------------------------------------------------------------------
; 367 | mem_pre = temp;                                                        
;----------------------------------------------------------------------
        MVMD      AR1,*(_mem_pre$1)
;----------------------------------------------------------------------
; 369 | return;                                                                
;----------------------------------------------------------------------
        ANDM      #-833,*(ST1)
        ANDM      #-4,*(PMST)
        POPM      AR1
        RET




	.sect	".text"
	.global	_pit_pst_filt
;----------------------------------------------------------------------
; 219 | void pit_pst_filt(                                                     
; 220 | Word16 *signal,      /* (i)     : input signal                        *
;     | /                                                                      
; 221 | Word16 *scal_sig,    /* (i)     : input signal (scaled, divided by 4) *
;     | /                                                                      
; 222 | Word16 t0_min,       /* (i)     : minimum value in the searched range *
;     | /                                                                      
; 223 | Word16 t0_max,       /* (i)     : maximum value in the searched range *
;     | /                                                                      
; 224 | Word16 L_subfr,      /* (i)     : size of filtering                   *
;     | /                                                                      
; 225 | Word16 *signal_pst   /* (o)     : harmonically postfiltered signal    *
;     | /                                                                      
; 226 | )                                                                      
;----------------------------------------------------------------------
_pit_pst_filt:

        PSHM      AR1
        PSHM      AR6
        PSHM      AR7
        FRAME     #-16
        NOP
;----------------------------------------------------------------------
; 228 | Word16 i, j, t0;                                                       
; 229 | Word16 g0, gain, cmax, en, en0;                                        
; 230 | Word16 *p, *p1, *deb_sig;                                              
; 231 | Word32 corr, cor_max, ener, ener0, temp;                               
; 232 | Word32 L_temp;                                                         
;----------------------------------------------------------------------
        STL       A,*SP(2)
        LD        *SP(24),A
        LD        *SP(21),B
        STL       A,*SP(3)
        MVDK      *SP(20),*(AR6)
        LD        *SP(23),A
        STL       A,*SP(4)
        MVDK      *SP(22),*(AR2)

;----------------------------------------------------------------------
; 239 | deb_sig = &scal_sig[-t0_min];                                          
; 240 | cor_max = MIN_32;                                                      
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       AR6,A
        SUB       B,A                   ; |239| 
        STLM      A,AR1

;----------------------------------------------------------------------
; 241 | t0 = t0_min;             /* Only to remove warning from some compilers
;     | */                                                                     
;----------------------------------------------------------------------
        STL       B,*SP(5)
;----------------------------------------------------------------------
; 242 | for (i=t0_min; i<=t0_max; i++)                                         
;----------------------------------------------------------------------
        LD        B,A
        STL       A,*SP(6)

        SSBX      SXM
        NOP
        LD        #-32768,16,A          ; |240| 
        DST       A,*SP(8)              ; |240| 

;----------------------------------------------------------------------
; 244 | corr = 0;                                                              
;----------------------------------------------------------------------
        LD        B,A
        LD        *(AL),A               ; |242| 
        SUB       *(AR2),A              ; |242| 
        BC        L7,AGT                ; |242| 

        LDM       AR2,A
        SUB       B,A
        ADD       #1,A,A
        STLM      A,AR7
        SSBX      OVM                   ; ****
        ;SSBX      SXM
        SSBX      FRCT
        ORM       #2,*(PMST)
L3:    
;----------------------------------------------------------------------
; 245 | p    = scal_sig;                                                       
;----------------------------------------------------------------------
        MVMM      AR6,AR2

;----------------------------------------------------------------------
; 246 | p1   = deb_sig;                                                        
;----------------------------------------------------------------------
        MVMM      AR1,AR3
        LD        #0,A
        DST       A,*SP(10)             ; |244| 
;----------------------------------------------------------------------
; 247 | for (j=0; j<L_subfr; j++)                                              
;----------------------------------------------------------------------
        LD        *SP(4),A
        BC        L5,ALEQ               ; |247| 

        LD        *SP(4),A
        SUB       #1,A,A
        STLM      A,BRC
        ;NOP
        DLD       *SP(10),A
        RPTB      LOOP_1-1
L4:    
;----------------------------------------------------------------------
; 248 | corr = L_mac(corr, *p++, *p1++);                                       
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;DLD       *SP(10),A
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        ;NOP
        MAC       *AR3+, *AR2+, A, A    ; |248| 
        ;DST       A,*SP(10)      
LOOP_1:
		DST       A,*SP(10)       
L5:    
;----------------------------------------------------------------------
; 250 | L_temp = L_sub(corr, cor_max);                                         
; 251 | if (L_temp > (Word32)0)                                                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;DLD       *SP(8),A
        ;RSBX      FRCT
        ;DST       A,*SP(0)              ; |250| 
        DLD       *SP(10),A             ; |250| 
        ;CALL      #_L_sub               ; |250| 
        DSUB      *SP(8),A
        
        ;RSBX      OVM
        ;SSBX      SXM
        ;SFTA      A,8                   ; |250| 
        ;SFTA      A,-8                  ; |250| 
        BC        L6,ALEQ               ; |250| 
;----------------------------------------------------------------------
; 253 | cor_max = corr;                                                        
;----------------------------------------------------------------------
        DLD       *SP(10),A
        DST       A,*SP(8)              ; |253| 
;----------------------------------------------------------------------
; 254 | t0 = i;                                                                
;----------------------------------------------------------------------
        LD        *SP(6),A
        STL       A,*SP(5)
L6:    
;----------------------------------------------------------------------
; 256 | deb_sig--;                                                             
;----------------------------------------------------------------------
        MAR       *AR1-
;----------------------------------------------------------------------
; 261 | ener = 1;                                                              
;----------------------------------------------------------------------
        LD        *SP(6),A
        ADD       #1,A
        BANZD     L3,*+AR7(-1)          ; |257| 
        NOP
        STL       A,*SP(6)
L7:    
;----------------------------------------------------------------------
; 262 | p = scal_sig - t0;                                                     
;----------------------------------------------------------------------
        LD        *SP(5),B
        LDM       AR6,A
        SUB       B,A                   ; |262| 
        STLM      A,AR1

        LD        #1,A
        DST       A,*SP(12)             ; |261| 

;----------------------------------------------------------------------
; 263 | for ( i=0; i<L_subfr ;i++, p++)                                        
;----------------------------------------------------------------------
        LD        *SP(4),A
        BC        L9,ALEQ               ; |263| 

        LD        *SP(4),A
        SUB       #1,A,A
        STLM      A,BRC
        NOP
        DLD       *SP(12),A
        RPTB      LOOP_2-1
L8:    
;----------------------------------------------------------------------
; 264 | ener = L_mac(ener, *p, *p);                                            
; 268 | ener0 = 1;                                                             
;----------------------------------------------------------------------
        LD        *AR1+,B
        ;RSBX      OVM
        STLM      B,T
        ;DLD       *SP(12),A
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |264| 
        ;DST       A,*SP(12)             ; |264| 
LOOP_2:
        DST       A,*SP(12)        
L9:    

;----------------------------------------------------------------------
; 269 | p = scal_sig;                                                          
;----------------------------------------------------------------------
        MVMM      AR6,AR2

        LD        #1,A
        DST       A,*SP(14)             ; |268| 

;----------------------------------------------------------------------
; 270 | for ( i=0; i<L_subfr; i++, p++)                                        
;----------------------------------------------------------------------
        LD        *SP(4),A
        BC        L11,ALEQ              ; |270| 

        ;RSBX      OVM
        LD        *SP(4),A
        SUB       #1,A,A
        STLM      A,BRC
        DLD       *SP(14),A             ; ****
        NOP
        RPTB      LOOP_3-1
L10:    
;----------------------------------------------------------------------
; 271 | ener0 = L_mac(ener0, *p, *p);                                          
;----------------------------------------------------------------------
        LD        *AR2+,B
        ;RSBX      OVM
        STLM      B,T
        ;DLD       *SP(14),A
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A               ; |271| 
        ;DST       A,*SP(14)             ; |271| 
LOOP_3:
	    DST       A,*SP(14)
L11:    
;----------------------------------------------------------------------
; 273 | if (cor_max < 0)                                                       
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(8),A
        BC        L12,AGEQ              ; |273| 

;----------------------------------------------------------------------
; 275 | cor_max = 0;                                                           
;----------------------------------------------------------------------
        LD        #0,A
        DST       A,*SP(8)              ; |275| 
L12:    
;----------------------------------------------------------------------
; 280 | temp = cor_max;                                                        
;----------------------------------------------------------------------
        DLD       *SP(8),A
        DST       A,*SP(10)             ; |280| 
;----------------------------------------------------------------------
; 281 | if (ener > temp)                                                       
;----------------------------------------------------------------------
        LD        A,B
        ;SFTA      B,8                   ; |281| 
        DLD       *SP(12),A             ; |281| 
        ;SFTA      B,-8                  ; |281| 
        SUB       A,B                   ; |281| 
        BCD       L13,BGEQ              ; |281| 
        NOP
        DST       A,*SP(12)             ; |281| 
;----------------------------------------------------------------------
; 283 | temp = ener;                                                           
;----------------------------------------------------------------------
        DST       A,*SP(10)             ; |283| 
L13:    
;----------------------------------------------------------------------
; 285 | if (ener0 > temp)                                                      
;----------------------------------------------------------------------
        DLD       *SP(14),A             ; |285| 
        DLD       *SP(10),B
        SUB       A,B                   ; |285| 
        BCD       L14,BGEQ              ; |285| 
        NOP
        DST       A,*SP(14)             ; |285| 

;----------------------------------------------------------------------
; 287 | temp = ener0;                                                          
; 289 | j = norm_l(temp);                                                      
;----------------------------------------------------------------------
        DST       A,*SP(10)             ; |287| 
L14:    
;----------------------------------------------------------------------
; 290 | cmax = round(L_shl(cor_max, j));                                       
;----------------------------------------------------------------------
        DLD       *SP(10),A
        EXP       A                     ; |290| 
        RSBX      FRCT
        MVMD      T,AR7
        MVKD      *(AR7),*SP(0)
        DLD       *SP(8),A              ; |290| 
        CALL      #_L_shl               ; |290| 
        
        RSBX      OVM
        SSBX      SXM
        SFTA      A,8                   ; |290| 
        SSBX      OVM
        SFTA      A,-8                  ; |290| 
        ADD       #1,#15,A,A            ; |290| 
        SFTA      A,-16,A               ; |290| 
        STLM      A,AR1
;----------------------------------------------------------------------
; 291 | en = round(L_shl(ener, j));                                            
;----------------------------------------------------------------------
        MVKD      *(AR7),*SP(0)
        ;RSBX      OVM
        ;RSBX      FRCT
        DLD       *SP(12),A             ; |291| 
        CALL      #_L_shl               ; |291| 
        
        RSBX      OVM
        SSBX      SXM
        SFTA      A,8                   ; |291| 
        SFTA      A,-8                  ; |291| 
        SSBX      OVM
        ADD       #1,#15,A,A            ; |291| 
        SFTA      A,-16,A               ; |291| 
        STLM      A,AR6

;----------------------------------------------------------------------
; 292 | en0 = round(L_shl(ener0, j));                                          
; 297 | temp = L_mult(cmax, cmax);                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        MVKD      *(AR7),*SP(0)
        ;RSBX      FRCT
        DLD       *SP(14),A             ; |292| 
        CALL      #_L_shl               ; |292| 
        
        RSBX      OVM
        SSBX      SXM
        SFTA      A,8                   ; |292| 
        SFTA      A,-8                  ; |292| 
        SSBX      OVM
        ADD       #1,#15,A,A            ; |292| 
        SFTA      A,-16,A               ; |292| 

;----------------------------------------------------------------------
; 298 | temp = L_sub(temp, L_shr(L_mult(en, en0), 1));                         
; 300 | if (temp < (Word32)0)           /* if prediction gain < 3 dB   */      
; 302 |   for (i = 0; i < L_subfr; i++)                                        
; 303 |     signal_pst[i] = signal[i];                                         
; 304 |   return;                                                              
;----------------------------------------------------------------------
        SSBX      FRCT
        STLM      A,T
        MPY       *(AR6),A              ; |298| 
        ;RSBX      OVM
        ;RSBX      FRCT
        ;ST        #1,*SP(0)             ; |298| 
        ;CALL      #_L_shr               ; |298| 
        SFTA       A,-1
        
        DST       A,*SP(0)              ; |298| 
        MVMD      AR1,T
        ;SSBX      FRCT
        ;SSBX      OVM
        MPY       *(AR1),A              ; |298| 
        ;RSBX      FRCT
        ;RSBX      OVM
        ;NOP
        ;CALL      #_L_sub               ; |298| 
        DSUB      *SP(0),A
        
        ;RSBX      OVM
        ;SSBX      SXM
        ;SFTA      A,8                   ; |298| 
        ;SFTA      A,-8                  ; |298| 
        BC        L20,ALT               ; |298| 

;----------------------------------------------------------------------
; 307 | if (sub(cmax, en) > 0)      /* if pitch gain > 1 */                    
; 309 |   g0 = INV_GAMMAP;                                                     
; 310 |   gain = GAMMAP_2;                                                     
; 312 | else {                                                                 
;----------------------------------------------------------------------
        LD        *(AR1),16,A           ; |307| 
        ;SSBX      OVM
        SUB       *(AR6),16,A,A         ; |307| 
        SFTA      A,-16,A               ; |307| 
        LD        *(AL),A               ; |307| 
        BC        L16,AGT               ; |307| 
;----------------------------------------------------------------------
; 313 | cmax = shr(mult(cmax, GAMMAP), 1);  /* cmax(Q14) = cmax(Q15) * GAMMAP *
;     | /                                                                      
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #16384,16,A           ; |313| 
        ;SSBX      FRCT
        ;SSBX      OVM
        MVMD      AR1,T
        MPYA      A                     ; |313| 
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #1,*SP(0)             ; |313| 
        ;CALLD     #_crshft              ; |313| 
        SFTA       A,-1
        NOP
        SFTA      A,-16,A               ; |313| 

        STLM      A,AR1
;----------------------------------------------------------------------
; 314 | en = shr(en, 1);          /* Q14 */                                    
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #1,*SP(0)             ; |314| 
        ;CALLD     #_crshft              ; |314| 
        SFTA       A,-1
        NOP
        LDM       AR6,A
   
        STLM      A,AR6

;----------------------------------------------------------------------
; 315 | i = add(cmax, en);                                                     
; 316 | if(i > 0)                                                              
; 318 |   gain = div_s(cmax, i);    /* gain(Q15) = cor_max/(cor_max+ener)  */  
; 319 |   g0 = sub(32767, gain);    /* g0(Q15) = 1 - gain */                   
; 321 | else                                                                   
;----------------------------------------------------------------------
        ;SSBX      SXM
        ;RSBX      OVM
        LD        *(AR1),16,A           ; |315| 
        ;SSBX      OVM
        ADD       *(AR6),16,A,A         ; |315| 
        SFTA      A,-16,A               ; |315| 
        LD        *(AL),A               ; |315| 
        BC        L15,AGT               ; |315| 

;----------------------------------------------------------------------
; 323 | g0 =  32767;                                                           
;----------------------------------------------------------------------
        LD        #32767,A
        STLM      A,AR3

;----------------------------------------------------------------------
; 324 | gain = 0;                                                              
;----------------------------------------------------------------------
        BD        L17                   ; |324| 
        STM       #0,AR5
        
L15:    
        RSBX      FRCT
        RSBX      OVM
        STL       A,*SP(0)
        CALLD     #_divs                ; |318| 
        NOP
        LDM       AR1,A
        
        STLM      A,AR5

        RSBX      OVM
        NOP
        LD        #32767,16,A           ; |319| 
        SSBX      SXM
        SSBX      OVM
        SUB       *(AR5),16,A,A         ; |319| 
        SFTA      A,-16,A               ; |319| 
        STLM      A,AR3

        B         L17                   ; |320| 
       
L16:    

        LD        #21845,A
        STLM      A,AR3
        NOP
        STM       #10923,AR5
L17:    
;----------------------------------------------------------------------
; 329 | for (i = 0; i < L_subfr; i++)                                          
;----------------------------------------------------------------------
        LD        *SP(4),A
        BC        L22,ALEQ              ; |329| 

        RSBX      OVM
        LD        *SP(5),B
        LD        *SP(2),A
        SUB       B,A
        MVDK      *SP(3),*(AR2)
        STLM      A,AR4
        LD        *SP(4),A
        SUB       #1,A,A
        STLM      A,BRC
        MVDK      *SP(2),*(AR1)
        SSBX      OVM
        SSBX      SXM
        SSBX      FRCT
        RPTB      L19-1
L18:    
;----------------------------------------------------------------------
; 333 | signal_pst[i] = add(mult(g0, signal[i]), mult(gain, signal[i-t0]));    
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        *AR4+,16,A            ; |333| 
        ;SSBX      FRCT
        ;SSBX      OVM
        MVMD      AR5,T
        MPYA      A                     ; |333| 
        ;RSBX      OVM
        SFTA      A,-16,B               ; |333| 
        LD        *AR1+,16,A            ; |333| 
        ;SSBX      OVM
        MVMD      AR3,T
        MPYA      A                     ; |333| 
        ADD       *(BL),16,A,A          ; |333| 
        STH       A,*AR2+               ; |333| 

L19:    
        B         L22                   ; |335| 
        
L20:    

        LD        *SP(4),A
        BC        L22,ALEQ              ; |302| 

        LD        *SP(4),A
        SUB       #1,A,A
        MVDK      *SP(3),*(AR2)
        STLM      A,BRC
        MVDK      *SP(2),*(AR3)
        RPTB      L22-1
        
L21:    

        MVDD      *AR3+,*AR2+           ; |303| 
        
L22:    

        ANDM      #-833,*(ST1)
        ANDM      #-4,*(PMST)
        FRAME     #16
        POPM      AR7
        POPM      AR6
        POPM      AR1
        RET




	.sect	".text"
	.global	_agc

;----------------------------------------------------------------------
; 382 | void agc(                                                              
; 383 | Word16 *sig_in,   /* (i)     : postfilter input signal  */             
; 384 | Word16 *sig_out,  /* (i/o)   : postfilter output signal */             
; 385 | Word16 l_trm      /* (i)     : subframe size            */             
; 386 | )                                                                      
;----------------------------------------------------------------------

_agc:

        PSHM      AR1
        PSHM      AR6
        PSHM      AR7
        FRAME     #-48
        NOP
;----------------------------------------------------------------------
; 388 | static Word16 past_gain=4096;         /* past_gain = 1.0 (Q12) */      
; 389 | Word16 i, exp;                                                         
; 390 | Word16 gain_in, gain_out, g0, gain;                     /* Q12 */      
; 391 | Word32 s;                                                              
; 393 | Word16 signal[L_SUBFR];                                                
;----------------------------------------------------------------------
        STL       A,*SP(42)
        LD        *SP(53),A
        STL       A,*SP(43)
        LD        *SP(52),A
        STL       A,*SP(44)
;----------------------------------------------------------------------
; 397 | for(i=0; i<l_trm; i++)                                                 
;----------------------------------------------------------------------
        SSBX      SXM
        SSBX      OVM
        SSBX      FRCT
        NOP
        LD        *SP(43),A
        BC        L24,ALEQ              ; |397| 

        MVMM      SP,AR1
        MVDK      *SP(43),*(AR7)
        MVDK      *SP(44),*(AR6)
        MAR       *+AR1(#2)
L23:    
;----------------------------------------------------------------------
; 398 | signal[i] = shr(sig_out[i], 2);                                        
;----------------------------------------------------------------------
        ;ST        #2,*SP(0)             ; |398| 
        ;RSBX      FRCT
        ;RSBX      OVM
        LD        *AR6+,A
        ;CALL      #_crshft              ; |398| 
        SFTA      A,-2
        
        BANZD     L23,*+AR7(-1)         ; |398| 
        NOP
        STL       A,*AR1+
L24:    
;----------------------------------------------------------------------
; 400 | s = 0;                                                                 
;----------------------------------------------------------------------
        LD        #0,A
;----------------------------------------------------------------------
; 401 | for(i=0; i<l_trm; i++)                                                 
;----------------------------------------------------------------------
        ;SSBX      SXM
        ;NOP
        LD        *SP(43),B
        BC        L26,BLEQ              ; |401| 

        ;RSBX      OVM
        LD        *SP(43),B
        MVMM      SP,AR1
        SUB       #1,B,B
        STLM      B,BRC
        MAR       *+AR1(#2)
        RPTB      L26-1

L25:    
;----------------------------------------------------------------------
; 402 | s = L_mac(s, signal[i], signal[i]);                                    
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,B
        ;SFTA      A,8                   ; |402| 
        STLM      B,T
        ;SFTA      A,-8                  ; |402| 
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |402| 
L26:    
;----------------------------------------------------------------------
; 404 | if (s == 0) {                                                          
; 405 |   past_gain = 0;                                                       
; 406 |   return;                                                              
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        A,B                   ; |404| 
        ;SFTA      B,8                   ; |404| 
        ;SFTA      B,-8                  ; |404| 
        BC        L35,BEQ               ; |404| 
;----------------------------------------------------------------------
; 408 | exp = sub(norm_l(s), 1);                                               
;----------------------------------------------------------------------
        LD        A,B                   ; |408| 
        ;SFTA      B,8                   ; |408| 
        ;SFTA      B,-8                  ; |408| 
        EXP       B                     ; |408| 
        LD        *(T),16,B             ; |408| 
        ;SSBX      OVM
        ;NOP
        SUB       #1,16,B,B             ; |408| 
        SFTA      B,-16,B               ; |408| 
        STL       B,*SP(45)

;----------------------------------------------------------------------
; 409 | gain_out = round(L_shl(s, exp));                                       
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;RSBX      OVM
        STL       B,*SP(0)
        CALL      #_L_shl               ; |409| 
        
        RSBX      OVM
        SSBX      SXM
        SFTA      A,8                   ; |409| 
        SFTA      A,-8                  ; |409| 
        SSBX      OVM
        ADD       #1,#15,A,A            ; |409| 
        SFTA      A,-16,A               ; |409| 
        STL       A,*SP(46)
;----------------------------------------------------------------------
; 413 | for(i=0; i<l_trm; i++)                                                 
;----------------------------------------------------------------------
        LD        *SP(43),A
        BC        L28,ALEQ              ; |413| 

        MVMM      SP,AR1
        MVDK      *SP(43),*(AR7)
        MVDK      *SP(42),*(AR6)
        MAR       *+AR1(#2)
L27:    
;----------------------------------------------------------------------
; 414 | signal[i] = shr(sig_in[i], 2);                                         
;----------------------------------------------------------------------
        ;ST        #2,*SP(0)             ; |414| 
        ;RSBX      FRCT
        ;RSBX      OVM
        LD        *AR6+,A
        ;CALL      #_crshft              ; |414| 
        SFTA      A,-2
        
        BANZD     L27,*+AR7(-1)         ; |414| 
        NOP
        STL       A,*AR1+
        
L28:    
;----------------------------------------------------------------------
; 416 | s = 0;                                                                 
;----------------------------------------------------------------------
        LD        #0,A
;----------------------------------------------------------------------
; 417 | for(i=0; i<l_trm; i++)                                                 
;----------------------------------------------------------------------
        ;SSBX      SXM
        ;NOP
        LD        *SP(43),B
        BC        L30,BLEQ              ; |417| 

        ;RSBX      OVM
        LD        *SP(43),B
        MVMM      SP,AR1
        SUB       #1,B,B
        STLM      B,BRC
        MAR       *+AR1(#2)
        SSBX      FRCT
        RPTB      L30-1
L29:    
;----------------------------------------------------------------------
; 418 | s = L_mac(s, signal[i], signal[i]);                                    
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,B
        ;SFTA      A,8                   ; |418| 
        STLM      B,T
        ;SFTA      A,-8                  ; |418| 
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |418| 
        
L30:    

;----------------------------------------------------------------------
; 420 | if (s == 0) {                                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        A,B                   ; |420| 
        ;SFTA      B,8                   ; |420| 
        ;SFTA      B,-8                  ; |420| 
        BC        L31,BNEQ              ; |420| 

;----------------------------------------------------------------------
; 421 | g0 = 0;                                                                
;----------------------------------------------------------------------
        LD        #0,A
        STL       A,*SP(46)

;----------------------------------------------------------------------
; 423 | else {                                                                 
; 424 |   i = norm_l(s);                                                       
;----------------------------------------------------------------------
        B         L32                   ; |422| 
        ; branch occurs ; |422| 
L31:    
;----------------------------------------------------------------------
; 425 | gain_in = round(L_shl(s, i));                                          
;----------------------------------------------------------------------
        LD        A,B                   ; |425| 
        ;SFTA      B,8                   ; |425| 
        ;SFTA      B,-8                  ; |425| 
        EXP       B                     ; |425| 
        RSBX      FRCT
        MVMD      T,AR1
        MVKD      *(AR1),*SP(0)
        CALL      #_L_shl               ; |425| 
        
        RSBX      OVM
        SSBX      SXM
        SFTA      A,8                   ; |425| 
        SSBX      OVM
        SFTA      A,-8                  ; |425| 
        ADD       #1,#15,A,A            ; |425| 
        SFTA      A,-16,B               ; |425| 
;----------------------------------------------------------------------
; 426 | exp = sub(exp, i);                                                     
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(45),A
        LD        *(AL),16,A            ; |426| 
        ;SSBX      OVM
        SUB       *(AR1),16,A,A         ; |426| 
        SFTA      A,-16,A               ; |426| 
        STL       A,*SP(45)
;----------------------------------------------------------------------
; 432 | s = L_deposit_l(div_s(gain_out,gain_in));   /* Q15 */                  
;----------------------------------------------------------------------
        RSBX      FRCT
        LD        *SP(46),A
        RSBX      OVM
        STL       B,*SP(0)
        CALL      #_divs                ; |432| 

        SSBX      SXM
        LD        *(AL),A               ; |432| 
        SSBX      OVM
;----------------------------------------------------------------------
; 433 | s = L_shl(s, 7);           /* s(Q22) = gain_out / gain_in */           
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #7,*SP(0)             ; |433| 
        ;CALL      #_L_shl               ; |433| 
        SFTA       A,7

;----------------------------------------------------------------------
; 434 | s = L_shr(s, exp);         /* Q22, add exponent */                     
;----------------------------------------------------------------------
        LD        *SP(45),B
        ;RSBX      FRCT
        ;RSBX      OVM
        STL       B,*SP(0)
        CALL      #_L_shr               ; |434| 

;----------------------------------------------------------------------
; 437 | s = Inv_sqrt(s);           /* Q19 */                                   
;----------------------------------------------------------------------
        RSBX      FRCT
        RSBX      OVM
        NOP
        CALL      #_Inv_sqrt            ; |437| 

;----------------------------------------------------------------------
; 438 | i = round(L_shl(s,9));     /* Q12 */                                   
;----------------------------------------------------------------------
        SSBX      SXM
        SSBX      OVM
        NOP
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #9,*SP(0)             ; |438| 
        ;CALL      #_L_shl               ; |438| 
        SFTA      A,9
        
        ;RSBX      OVM
        ;SSBX      SXM
        ;SFTA      A,8                   ; |438| 
        ;SFTA      A,-8                  ; |438| 
        ;SSBX      OVM
        ADD       #1,#15,A,A            ; |438| 
        SFTA      A,-16,B               ; |438| 

;----------------------------------------------------------------------
; 441 | g0 = mult(i, AGC_FAC1);       /* Q12 */                                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #3276,16,A            ; |441| 
        ;SSBX      OVM
        STLM      B,T
        SSBX      FRCT
        NOP
        MPYA      A                     ; |441| 
        SFTA      A,-16,A               ; |441| 
        STL       A,*SP(46)
L32:    
;----------------------------------------------------------------------
; 447 | gain = past_gain;                                                      
;----------------------------------------------------------------------
        MVDM      *(_past_gain$2),AR1
;----------------------------------------------------------------------
; 448 | for(i=0; i<l_trm; i++) {                                               
;----------------------------------------------------------------------
        LD        *SP(43),A
        BC        L34,ALEQ              ; |448| 

        MVDK      *SP(43),*(AR7)
        MVDK      *SP(44),*(AR6)
L33:    
;----------------------------------------------------------------------
; 449 | gain = mult(gain, AGC_FAC);                                            
; 450 | gain = add(gain, g0);                                                  
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      FRCT
        ;SSBX      SXM
        MVMD      AR1,T
        LD        #29491,16,A           ; |449| 
        ;SSBX      OVM
        LD        *SP(46),B
        MPYA      A                     ; |449| 
        ADD       *(BL),16,A,A          ; |449| 
        SFTA      A,-16,A               ; |449| 
        STLM      A,AR1
;----------------------------------------------------------------------
; 451 | sig_out[i] = extract_h(L_shl(L_mult(sig_out[i], gain), 3));            
;----------------------------------------------------------------------
        ;ST        #3,*SP(0)             ; |451| 
        MVMD      AR1,T
        MPY       *AR6,A                ; |451| 
        ;RSBX      FRCT
        ;RSBX      OVM
        ;NOP
        ;CALL      #_L_shl               ; |451| 
        SFTA      A,3
        
        SFTL      A,#-16,A              ; |451| 
        STL       A,*AR6+               ; |451| 
        BANZ      L33,*+AR7(-1)         ; |452| 
        
L34:    

;----------------------------------------------------------------------
; 453 | past_gain = gain;                                                      
;----------------------------------------------------------------------
        MVMD      AR1,*(_past_gain$2)
;----------------------------------------------------------------------
; 455 | return;                                                                
;----------------------------------------------------------------------
        B         L36                   ; |455| 
       
L35:    

        ST        #0,*(_past_gain$2)    ; |405| 
L36:    
        ANDM      #-833,*(ST1)
        ANDM      #-4,*(PMST)
        FRAME     #48
        POPM      AR7
        POPM      AR6
        POPM      AR1
        RET




	.sect	".text"
	.global	_Post_Filter
;----------------------------------------------------------------------
;  90 | void Post_Filter(                                                      
;  91 | Word16 *syn,       /* in/out: synthesis speech (postfiltered is output)
;     |     */                                                                 
;  92 | Word16 *Az_4,      /* input : interpolated LPC parameters in all subfra
;     | mes */                                                                 
;  93 | Word16 *T          /* input : decoded pitch lags in all subframes
;     |     */                                                                 
;  94 | )                                                                      
;----------------------------------------------------------------------
_Post_Filter:

        PSHM      AR1
        RSBX      OVM
        PSHM      AR6
        PSHM      FP
        ADDM      #-178,*(SP)
        NOP
        NOP
        MVMM      SP,FP
;----------------------------------------------------------------------
; 100 | Word16 res2_pst[L_SUBFR];  /* res2[] after pitch postfiltering */      
; 101 | Word16 syn_pst[L_FRAME];   /* post filtered synthesis speech   */      
; 103 | Word16 Ap3[MP1], Ap4[MP1];  /* bandwidth expanded LP parameters */     
; 105 | Word16 *Az;                 /* pointer to Az_4:                 */     
; 107 | Word16   t0_max, t0_min;    /* closed-loop pitch search range   */     
; 108 | Word16   i_subfr;           /* index for beginning of subframe  */     
; 110 | Word16 h[L_H];                                                         
; 112 | Word16  i, j;                                                          
; 113 | Word16  temp1, temp2;                                                  
; 114 | Word32  L_tmp;                                                         
;----------------------------------------------------------------------
        STL       A,*FP(170)
        LD        *FP(183),A
        STL       A,*FP(171)
        LD        *FP(182),A

;----------------------------------------------------------------------
; 120 | Az = Az_4;                                                             
; 122 | for (i_subfr = 0; i_subfr < L_FRAME; i_subfr += L_SUBFR)               
;----------------------------------------------------------------------
        MVMM      SP,AR6
        MAR       *+AR6(#46)
        STL       A,*FP(172)
        LD        *FP(170),A
        STL       A,*FP(173)
        LD        #_mem_syn_pst,A
        STL       A,*FP(174)
        LD        #2,A
        STL       A,*FP(175)
L37:    
;----------------------------------------------------------------------
; 126 | t0_min = sub(*T++, 3);                                                 
;----------------------------------------------------------------------
        SSBX      SXM
        MVDK      *FP(171),*(AR1)
        LD        *AR1+,16,A            ; |126| 
        SSBX      OVM
        NOP
        SUB       #3,16,A,A             ; |126| 
        SFTA      A,-16,A               ; |126| 
        STL       A,*FP(176)
        MVKD      *(AR1),*FP(171)
;----------------------------------------------------------------------
; 127 | t0_max = add(t0_min, 6);                                               
; 128 | if (sub(t0_max, PIT_MAX) > 0) {                                        
; 129 |   t0_max = PIT_MAX;                                                    
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *(AL),16,A            ; |127| 
        ;SSBX      OVM
        NOP
        ADD       #6,16,A,A             ; |127| 
        SFTA      A,-16,A               ; |127| 
        ;RSBX      OVM
        STL       A,*FP(177)
        LD        *(AL),A               ; |127| 
        SUB       #144,A,A              ; |127| 
        BC        L38,ALT               ; |127| 

;----------------------------------------------------------------------
; 130 | t0_min = sub(t0_max, 6);                                               
;----------------------------------------------------------------------
        LD        #143,16,A             ; |130| 
        ;SSBX      OVM
        NOP
        SUB       #6,16,A,A             ; |130| 
        SFTA      A,-16,A               ; |130| 
        STL       A,*FP(176)

        LD        #143,A
        STL       A,*FP(177)
L38:    

;----------------------------------------------------------------------
; 135 | Weight_Az(Az, GAMMA2_PST, M, Ap3);                                     
;----------------------------------------------------------------------
        ST        #18022,*SP(0)         ; |135| 
        RSBX      OVM
        LDM       SP,A
        ST        #10,*SP(1)            ; |135| 
        ADD       #126,A
        STL       A,*SP(2)
        RSBX      FRCT
        LD        *FP(172),A
        CALL      #_Weight_Az           ; |135| 

;----------------------------------------------------------------------
; 136 | Weight_Az(Az, GAMMA1_PST, M, Ap4);                                     
;----------------------------------------------------------------------
        ST        #22938,*SP(0)         ; |136| 
        RSBX      OVM
        LDM       SP,A
        ST        #10,*SP(1)            ; |136| 
        ADD       #137,A
        STL       A,*SP(2)
        RSBX      FRCT
        LD        *FP(172),A
        CALL      #_Weight_Az           ; |136| 

;----------------------------------------------------------------------
; 140 | Residu(Ap3, &syn[i_subfr], res2, L_SUBFR);                             
;----------------------------------------------------------------------
        LD        *FP(173),A
        STL       A,*SP(0)
        MVKD      *(_res2),*SP(1)       ; |140| 
        RSBX      FRCT
        RSBX      OVM
        LDM       SP,A
        ST        #40,*SP(2)            ; |140| 
        CALLD     #_Residu              ; |140| 
        ADD       #126,A

;----------------------------------------------------------------------
; 144 | for (j=0; j<L_SUBFR; j++)                                              
;----------------------------------------------------------------------
        STM       #0,AR1
        SSBX      OVM
        SSBX      SXM
        NOP
L39:    

;----------------------------------------------------------------------
; 146 | scal_res2[j] = shr(res2[j], 2);                                        
;----------------------------------------------------------------------

        ;RSBX      OVM
        LDM       AR1,A
        ADD       *(_res2),A
        STLM      A,AR2
        ;ST        #2,*SP(0)             ; |146| 
        ;RSBX      FRCT
        LD        *AR2,A
        ;CALL      #_crshft              ; |146| 
        SFTA      A,-2
        
        LDM       AR1,B
        ;RSBX      OVM
        ADD       *(_scal_res2),B
        STLM      B,AR2
        NOP
        NOP
        STL       A,*AR2

        MAR       *AR1+
        ;SSBX      SXM
        LDM       AR1,A
        LD        *(AL),A               ; |147| 
        SUB       #40,A,A               ; |147| 
        BC        L39,ALT               ; |147| 

;----------------------------------------------------------------------
; 151 | pit_pst_filt(res2, scal_res2, t0_min, t0_max, L_SUBFR, res2_pst);      
;----------------------------------------------------------------------
        MVKD      *(_scal_res2),*SP(0)  ; |151| 
        LD        *FP(176),A
        STL       A,*SP(1)
        RSBX      FRCT
        LD        *FP(177),A
        STL       A,*SP(2)
        LDM       SP,A
        ADD       #6,A
        ST        #40,*SP(3)            ; |151| 
        STL       A,*SP(4)
        LD        *(_res2),A
        CALL      #_pit_pst_filt        ; |151| 

;----------------------------------------------------------------------
; 157 | Copy(Ap3, h, M+1);                                                     
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       SP,A
        ADD       #148,A
        STL       A,*SP(0)
        LDM       SP,A
        RSBX      FRCT
        ST        #11,*SP(1)            ; |157| 
        CALLD     #_Copy                ; |157| 
        ADD       #126,A

;----------------------------------------------------------------------
; 158 | Set_zero(&h[M+1], L_H-M-1);                                            
;----------------------------------------------------------------------
        RSBX      FRCT
        ST        #11,*SP(0)            ; |158| 
        MVMM      SP,AR1
        RSBX      OVM
        MAR       *+AR1(#159)
        CALLD     #_Set_zero            ; |158| 
        NOP
        LDM       AR1,A

;----------------------------------------------------------------------
; 159 | Syn_filt(Ap4, h, h, L_H, &h[M+1], 0);                                  
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       SP,A
        ADD       #148,A
        STL       A,*SP(0)
        LDM       SP,A
        ADD       #148,A
        STL       A,*SP(1)
        ST        #22,*SP(2)            ; |159| 
        MVKD      *(AR1),*SP(3)
        RSBX      FRCT
        LDM       SP,A
        ST        #0,*SP(4)             ; |159| 
        CALLD     #_Syn_filt            ; |159| 
        ADD       #137,A

;----------------------------------------------------------------------
; 163 | L_tmp = L_mult(h[0], h[0]);                                            
;----------------------------------------------------------------------
        SSBX      FRCT
        SSBX      OVM
        SSBX      SXM
        ORM       #2,*(PMST)
        LD        *FP(148),T
        MPY       *FP(148),A            ; |163| 
        MVMM      SP,AR1
        STM       #20,BRC
        MAR       *+AR1(#149)
        RPTB      L41-1
L40:    
;----------------------------------------------------------------------
; 164 | for (i=1; i<L_H; i++) L_tmp = L_mac(L_tmp, h[i], h[i]);                
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,B
        ;SSBX      SXM
        ;SFTA      A,8                   ; |164| 
        STLM      B,T
        ;SFTA      A,-8                  ; |164| 
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |164| 
       
L41:    
;----------------------------------------------------------------------
; 165 | temp1 = extract_h(L_tmp);                                              
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |165| 
        STLM      A,AR2
;----------------------------------------------------------------------
; 167 | L_tmp = L_mult(h[0], h[1]);                                            
;----------------------------------------------------------------------
        MVMM      SP,AR1
        MAR       *+AR1(#149)
        STM       #19,BRC
        LD        *AR1,T
        MVMM      AR1,AR3
        MPY       *FP(148),B            ; |167| 
        RPTB      L43-1
L42:    
;----------------------------------------------------------------------
; 168 | for (i=1; i<L_H-1; i++) L_tmp = L_mac(L_tmp, h[i], h[i+1]);            
; 169 | temp2 = extract_h(L_tmp);                                              
;----------------------------------------------------------------------
        ;RSBX      OVM
        MVMM      AR3,AR4
        ;SSBX      SXM
        ;SFTA      B,8                   ; |168| 
        MAR       *AR4+
        ;SFTA      B,-8                  ; |168| 
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        NOP
        MAC       *AR4, *AR3, B, B      ; |168| 
        MAR       *AR3+
 
L43:    
;----------------------------------------------------------------------
; 171 | if(temp2 <= 0) {                                                       
; 172 |   temp2 = 0;                                                           
;----------------------------------------------------------------------
        LD        B,A                   ; |171| 
        ;SSBX      SXM
        SFTL      A,#-16,A              ; |171| 
        LD        *(AL),A               ; |171| 
        BC        L44,AGT               ; |171| 
        
        BD        L45                   ; |171| 
        NOP
        LD        #0,A
        
L44:    
        RSBX      OVM
        SFTL      B,#-16,B              ; |171| 
        LD        #26214,16,A           ; |171| 
        STLM      B,T
        SSBX      OVM
        NOP
        MPYA      A                     ; |171| 
        RSBX      FRCT
        RSBX      OVM
        MVKD      *(AR2),*SP(0)
        CALLD     #_divs                ; |171| 
        NOP
        SFTA      A,-16,A               ; |171| 
       
L45:    
;----------------------------------------------------------------------
; 174 | else {                                                                 
; 175 |   temp2 = mult(temp2, MU);                                             
; 176 |   temp2 = div_s(temp2, temp1);                                         
; 179 | preemphasis(res2_pst, temp2, L_SUBFR);                                 
;----------------------------------------------------------------------
        STL       A,*SP(0)
        RSBX      FRCT
        RSBX      OVM
        LDM       SP,A
        ST        #40,*SP(1)            ; |173| 
        CALLD     #_preemphasis         ; |173| 
        ADD       #6,A

;----------------------------------------------------------------------
; 183 | Syn_filt(Ap4, res2_pst, &syn_pst[i_subfr], L_SUBFR, mem_syn_pst, 1);   
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       SP,A
        ADD       #6,A
        STL       A,*SP(0)
        MVKD      *(AR6),*SP(1)
        RSBX      FRCT
        ST        #40,*SP(2)            ; |183| 
        LD        *FP(174),A
        STL       A,*SP(3)
        LDM       SP,A
        ST        #1,*SP(4)             ; |183| 
        CALLD     #_Syn_filt            ; |183| 
        ADD       #137,A

;----------------------------------------------------------------------
; 187 | agc(&syn[i_subfr], &syn_pst[i_subfr], L_SUBFR);                        
;----------------------------------------------------------------------
        MVKD      *(AR6),*SP(0)
        ST        #40,*SP(1)            ; |187| 
        RSBX      FRCT
        RSBX      OVM
        LD        *FP(173),A
        CALL      #_agc                 ; |187| 

;----------------------------------------------------------------------
; 191 | Copy(&res2[L_SUBFR-PIT_MAX], &res2[-PIT_MAX], PIT_MAX);                
;----------------------------------------------------------------------
        SSBX      SXM
        RSBX      OVM
        LD        *(_res2),A
        ADD       #-143,A
        STL       A,*SP(0)
        ST        #143,*SP(1)           ; |191| 
        RSBX      FRCT
        LD        *(_res2),A
        CALLD     #_Copy                ; |191| 
        SUB       #103,A,A              ; |191| 

;----------------------------------------------------------------------
; 192 | Copy(&scal_res2[L_SUBFR-PIT_MAX], &scal_res2[-PIT_MAX], PIT_MAX);      
;----------------------------------------------------------------------
        RSBX      OVM
        SSBX      SXM
        LD        *(_scal_res2),A
        ADD       #-143,A
        STL       A,*SP(0)
        LD        *(_scal_res2),A
        RSBX      FRCT
        ST        #143,*SP(1)           ; |192| 
        CALLD     #_Copy                ; |192| 
        SUB       #103,A,A              ; |192| 

;----------------------------------------------------------------------
; 194 | Az += MP1;                                                             
;----------------------------------------------------------------------
        RSBX      OVM
        LD        *FP(172),A
        ADD       #11,A
        STL       A,*FP(172)

        LD        *FP(173),A
        MAR       *+AR6(#40)
        MVDK      *FP(175),*(AR1)
        MAR       *+AR1(#-1)
        ADD       #40,A
        MVKD      *(AR1),*FP(175)
        BANZD     L37,*AR1       
              
        STL       A,*FP(173)

;----------------------------------------------------------------------
; 199 | Copy(&syn[L_FRAME-M], &syn[-M], M);                                    
;----------------------------------------------------------------------
        LD        *FP(170),A
        SUB       #10,A,A               ; |199| 
        RSBX      FRCT
        STL       A,*SP(0)
        ST        #10,*SP(1)            ; |199| 
        LD        *FP(170),A
        CALLD     #_Copy                ; |199| 
        ADD       #70,A,A               ; |199| 

;----------------------------------------------------------------------
; 203 | Copy(syn_pst, syn, L_FRAME);                                           
;----------------------------------------------------------------------
        LD        *FP(170),A
        RSBX      FRCT
        RSBX      OVM
        STL       A,*SP(0)
        LDM       SP,A
        ST        #80,*SP(1)            ; |203| 
        CALLD     #_Copy                ; |203| 
        ADD       #46,A

;----------------------------------------------------------------------
; 205 | return;                                                                
;----------------------------------------------------------------------
        ANDM      #-833,*(ST1)
        ANDM      #-4,*(PMST)
        RSBX      OVM
        ADDM      #178,*(SP)
        NOP
        NOP
        POPM      FP
        POPM      AR6
        POPM      AR1
        RET




	.sect	".text"
	.global	_Init_Post_Filter
;----------------------------------------------------------------------
;  59 | void Init_Post_Filter(void)                                            
;----------------------------------------------------------------------
_Init_Post_Filter:

        PSHM      AR1
        PSHM      AR6
        FRAME     #-3

;----------------------------------------------------------------------
;  61 | res2  = res2_buf + PIT_MAX;                                            
;----------------------------------------------------------------------
        STM       #_res2_buf,AR6
        LDM       AR6,A
        ADD       #143,A,A              ; |61| 
        STL       A,*(_res2)

;----------------------------------------------------------------------
;  62 | scal_res2  = scal_res2_buf + PIT_MAX;                                  
;----------------------------------------------------------------------
        STM       #_scal_res2_buf,AR1
        LDM       AR1,A
        ADD       #143,A,A              ; |62| 
        STL       A,*(_scal_res2)

;----------------------------------------------------------------------
;  64 | Set_zero(mem_syn_pst, M);                                              
;----------------------------------------------------------------------
        ST        #10,*SP(0)            ; |64| 
        CALLD     #_Set_zero            ; |64| 
        LD        #_mem_syn_pst,A

;----------------------------------------------------------------------
;  65 | Set_zero(res2_buf, PIT_MAX+L_SUBFR);                                   
;----------------------------------------------------------------------
        ST        #183,*SP(0)           ; |65| 
        CALLD     #_Set_zero            ; |65| 
        NOP
        LDM       AR6,A

;----------------------------------------------------------------------
;  66 | Set_zero(scal_res2_buf, PIT_MAX+L_SUBFR);                              
;----------------------------------------------------------------------
        ST        #183,*SP(0)           ; |66| 
        CALLD     #_Set_zero            ; |66| 
        NOP
        LDM       AR1,A

;----------------------------------------------------------------------
;  68 | return;                                                                
;----------------------------------------------------------------------

        FRAME     #3
        POPM      AR6
        POPM      AR1
        RET



;***************************************************************
;* UNDEFINED EXTERNAL REFERENCES                               *
;***************************************************************
	.global	_L_shl
	.global	_L_shr
	.global	_Inv_sqrt
	.global	_Weight_Az
	.global	_Residu
	.global	_Syn_filt
	.global	_Copy
	.global	_Set_zero
	.global	_divs

