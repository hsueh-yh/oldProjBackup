	.mmregs
FP	.set	AR7
	.sect	".text"
;----------------------------------------------------------------------
; 104 | static void Cor_h(                                                     
; 105 | Word16 *H,     /* (i) Q12 :Impulse response of filters */              
; 106 | Word16 *rr     /* (o)     :Correlations of H[]         */              
; 107 | )                                                                      
;----------------------------------------------------------------------
_Cor_h:

        PSHM      AR1
        PSHM      AR6
        PSHM      AR7
        FRAME     #-60
        STLM      A,AR1
        LD        *SP(64),A
        STL       A,*SP(42)
        MVMM      AR1,AR2
;----------------------------------------------------------------------
; 123 | cor = 0;                                                               
; 124 | for(i=0; i<L_SUBFR; i++)                                               
;----------------------------------------------------------------------
        STM       #39,BRC
        LD        #0,A
        
        SSBX      SXM
        SSBX      OVM
        SSBX      FRCT
        ORM       #2,*(PMST)
        RPTB      L2-1
L1:    
;----------------------------------------------------------------------
; 125 | cor = L_mac(cor, H[i], H[i]);                                          
;----------------------------------------------------------------------
        LD        *AR2+,B            
        STLM      B,T
        MAC       *(BL), A             
L2:    
;----------------------------------------------------------------------
; 127 | if(sub(extract_h(cor),32000) > 0)                                      
; 129 |   for(i=0; i<L_SUBFR; i++) {                                           
; 130 |     h[i] = shr(H[i], 1);                                               
; 133 | else                                                                   
; 135 |   k = norm_l(cor);                                                     
;----------------------------------------------------------------------
        LD        A,B                   
        SFTL      B,#-16,B              
        LD        *(BL),B               
        SUB       #32000,B,B            
        BC        L4,BGT               

;----------------------------------------------------------------------
; 136 | k = shr(k, 1);                                                         
; 138 | for(i=0; i<L_SUBFR; i++) {                                             
;----------------------------------------------------------------------
        EXP       A                       
        NOP
        LD        *(T),A
        SFTA      A,-1
        
        STM       #40,AR7
        MVMM      SP,AR6
        MAR       *+AR6(#2)
        STL       A,*SP(43)
L3:    
;----------------------------------------------------------------------
; 139 | h[i] = shl(H[i], k);                                                   
;----------------------------------------------------------------------
        LD        *SP(43),A
        STL       A,*SP(0)
        LD        *AR1+,A
        CALL      #_shl              
        
        NOP
        STL       A,*AR6+
;----------------------------------------------------------------------
; 148 | rri0i0 = rr;                                                           
; 149 | rri1i1 = rri0i0 + NB_POS;                                              
; 150 | rri2i2 = rri1i1 + NB_POS;                                              
; 151 | rri3i3 = rri2i2 + NB_POS;                                              
; 152 | rri4i4 = rri3i3 + NB_POS;                                              
;----------------------------------------------------------------------
        BANZ      L3,*+AR7(-1)          
        B         L6                            
L4:    
        MVMM      SP,AR6
        STM       #40,AR7
        MAR       *+AR6(#2)
L5:    

        LD        *AR1+,A
            
        SFTA      A,-1        
        NOP
        STL       A,*AR6+
        BANZ      L5,*+AR7(-1)         
        
L6:    
;----------------------------------------------------------------------
; 153 | rri0i1 = rri4i4 + NB_POS;                                              
;----------------------------------------------------------------------
        RSBX      OVM
        LD        *SP(42),A
        ADD       #102,A,A              
        STL       A,*SP(44)
;----------------------------------------------------------------------
; 154 | rri0i2 = rri0i1 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #166,A,A              
        STL       A,*SP(45)
;----------------------------------------------------------------------
; 155 | rri0i3 = rri0i2 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #231,A,A              
        STL       A,*SP(46)
;----------------------------------------------------------------------
; 156 | rri0i4 = rri0i3 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #295,A,A              
        STL       A,*SP(47)
;----------------------------------------------------------------------
; 157 | rri1i2 = rri0i4 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #358,A,A             
        STL       A,*SP(48)
;----------------------------------------------------------------------
; 158 | rri1i3 = rri1i2 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #422,A,A              
        STL       A,*SP(49)
;----------------------------------------------------------------------
; 159 | rri1i4 = rri1i3 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #487,A,A              
        STL       A,*SP(50)
;----------------------------------------------------------------------
; 160 | rri2i3 = rri1i4 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #550,A,A              
        STL       A,*SP(51)
;----------------------------------------------------------------------
; 161 | rri2i4 = rri2i3 + MSIZE;                                               
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #614,A,A              
        STL       A,*SP(52)
;----------------------------------------------------------------------
; 163 | p0 = rri0i0 + NB_POS-1;   /* Init pointers to last position of rrixix[]
;     |  */                                                                    
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #7,A,A                
        STLM      A,AR5
;----------------------------------------------------------------------
; 164 | p1 = rri1i1 + NB_POS-1;                                                
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #15,A,A               
        STLM      A,AR2
;----------------------------------------------------------------------
; 165 | p2 = rri2i2 + NB_POS-1;                                                
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #23,A,A               
        STLM      A,AR3
;----------------------------------------------------------------------
; 166 | p3 = rri3i3 + NB_POS-1;                                                
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #31,A,A              
        STLM      A,AR4
;----------------------------------------------------------------------
; 167 | p4 = rri4i4 + NB_POS-1;                                                
;----------------------------------------------------------------------
        LD        *SP(42),A
        ADD       #39,A,A              
        STLM      A,AR0
;----------------------------------------------------------------------
; 169 | ptr_h1 = h;                                                            
;----------------------------------------------------------------------
        MVMM      SP,AR1
        MAR       *+AR1(#2)
;----------------------------------------------------------------------
; 170 | cor    = 0;                                                            
; 171 | for(i=0;  i<NB_POS; i++)                                               
;----------------------------------------------------------------------
        LD        #0,B
        STM       #7,BRC
        SSBX      SXM              ; ****
        SSBX      OVM              ; ****
        SSBX      FRCT             ; ****
        ORM       #2,*(PMST)       ; ****
        RPTB      L8-1
L7:    
;----------------------------------------------------------------------
; 173 | cor = L_mac(cor, *ptr_h1, *ptr_h1); ptr_h1++;                          
;----------------------------------------------------------------------
        LD        *AR1+,A                  
        STLM      A,T
        MAC       *(AL), B              
;----------------------------------------------------------------------
; 174 | *p4-- = extract_h(cor);                                                
;----------------------------------------------------------------------
        LD        B,A                   
        SFTL      A,#-16,A              
        STL       A,*AR0-                
;----------------------------------------------------------------------
; 176 | cor = L_mac(cor, *ptr_h1, *ptr_h1); ptr_h1++;                          
;----------------------------------------------------------------------
        LD        *AR1+,A                
        STLM      A,T               
        MAC       *(AL), B              

;----------------------------------------------------------------------
; 177 | *p3-- = extract_h(cor);                                                
;----------------------------------------------------------------------
        LD        B,A                   ; |177| 
        SFTL      A,#-16,A              ; |177| 
        STL       A,*AR4-               ; |177| 

;----------------------------------------------------------------------
; 179 | cor = L_mac(cor, *ptr_h1, *ptr_h1); ptr_h1++;                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,A
        ;SFTA      B,8                   ; |179| 
        STLM      A,T
        ;SSBX      OVM
        ;SFTA      B,-8                  ; |179| 
        MAC       *(AL), B              ; |179| 

;----------------------------------------------------------------------
; 180 | *p2-- = extract_h(cor);                                                
;----------------------------------------------------------------------
        LD        B,A                   ; |180| 
        SFTL      A,#-16,A              ; |180| 
        STL       A,*AR3-               ; |180| 
;----------------------------------------------------------------------
; 182 | cor = L_mac(cor, *ptr_h1, *ptr_h1); ptr_h1++;                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,A
        ;SFTA      B,8                   ; |182| 
        STLM      A,T
        ;SSBX      OVM
        ;SFTA      B,-8                  ; |182| 
        MAC       *(AL), B              ; |182| 

;----------------------------------------------------------------------
; 183 | *p1-- = extract_h(cor);                                                
;----------------------------------------------------------------------
        LD        B,A                   ; |183| 
        SFTL      A,#-16,A              ; |183| 
        STL       A,*AR2-               ; |183| 

;----------------------------------------------------------------------
; 185 | cor = L_mac(cor, *ptr_h1, *ptr_h1); ptr_h1++;                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1+,A
        ;SFTA      B,8                   ; |185| 
        STLM      A,T
        ;SSBX      OVM
        ;SFTA      B,-8                  ; |185| 
        MAC       *(AL), B              ; |185| 

;----------------------------------------------------------------------
; 186 | *p0-- = extract_h(cor);                                                
;----------------------------------------------------------------------
        LD        B,A                   ; |186| 
        SFTL      A,#-16,A              ; |186| 
        STL       A,*AR5-               ; |186| 
;----------------------------------------------------------------------
; 193 | l_fin_sup = MSIZE-1;                                                   
; 194 | l_fin_inf = l_fin_sup-(Word16)1;                                       
; 195 | ldec = NB_POS+1;                                                       
; 197 | ptr_hd = h;                                                            
;---------------------------------------------------------------------- 
L8:    
;----------------------------------------------------------------------
; 198 | ptr_hf = ptr_hd + 1;                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(51),A
        ADD       #1,A,A
        STL       A,*SP(53)
        LD        *SP(48),A
        ADD       #1,A,A
        STL       A,*SP(54)
        LD        *SP(44),A
        ADD       #1,A,A
        STL       A,*SP(42)
        MVMM      SP,AR6
        LD        *SP(47),A
        SUB       #1,A,A
        STL       A,*SP(43)
        MAR       *+AR6(#3)

;----------------------------------------------------------------------
; 200 | for(k=0; k<NB_POS; k++) {                                              
;----------------------------------------------------------------------
        STM       #7,AR7
        STM       #0,BK
L9:    
;----------------------------------------------------------------------
; 202 | p3 = rri2i3 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(53),*(AR5)
;----------------------------------------------------------------------
; 203 | p2 = rri1i2 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(54),*(AR1)
;----------------------------------------------------------------------
; 204 | p1 = rri0i1 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(42),*(AR2)
;----------------------------------------------------------------------
; 205 | p0 = rri0i4 + l_fin_inf;                                               
; 207 | cor = 0;                                                               
; 208 | ptr_h1 = ptr_hd;                                                       
;----------------------------------------------------------------------
        MVDK      *SP(43),*(AR0)
;----------------------------------------------------------------------
; 209 | ptr_h2 =  ptr_hf;                                                      
;----------------------------------------------------------------------
        MVMM      AR6,AR4

        LD        #0,A
        DST       A,*SP(56)            

        MVMM      SP,AR3
        MAR       *+AR3(#2)

;----------------------------------------------------------------------
; 211 | for(i=k+(Word16)1; i<NB_POS; i++ ) {                                   
;----------------------------------------------------------------------
        ;SSBX      SXM
        LD        *(BK),B               ; |211| 
        SUB       #7,B,B                ; |211| 
        BC        L11,BGEQ              ; |211| 

        LDM       BK,A
        LD        #6,B
        SUB       A,B
        STLM      B,BRC
        SSBX      OVM
        NOP
        RPTB      L11-1
L10:    
;----------------------------------------------------------------------
; 213 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        NOP
        MAC       *AR4+, *AR3+, A, A    ; |213| 
;----------------------------------------------------------------------
; 214 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |214| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |214| 
        MAC       *AR4+, *AR3+, A, A    ; |214| 
        DST       A,*SP(56)             ; |214| 
;----------------------------------------------------------------------
; 215 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,B              ; |215| 
        STL       B,*AR5                ; |215| 
;----------------------------------------------------------------------
; 217 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        NOP
        MAC       *AR4+, *AR3+, A, A    ; |217| 
;----------------------------------------------------------------------
; 218 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |218| 
        STL       B,*AR1                ; |218| 
;----------------------------------------------------------------------
; 220 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   
        ;SSBX      OVM
        ;SFTA      A,-8                  
        MAC       *AR4+, *AR3+, A, A    

;----------------------------------------------------------------------
; 221 | *p1 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              
        STL       B,*AR2                

;----------------------------------------------------------------------
; 223 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   
        ;SSBX      OVM
        ;SFTA      A,-8                  
        MAC       *AR4+, *AR3+, A, A    
        DST       A,*SP(56)             

;----------------------------------------------------------------------
; 224 | *p0 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |224| 
        STL       B,*AR0                ; |224| 

;----------------------------------------------------------------------
; 226 | p3 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR5(#-9)
;----------------------------------------------------------------------
; 227 | p2 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR1(#-9)
;----------------------------------------------------------------------
; 228 | p1 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR2(#-9)
;----------------------------------------------------------------------
; 229 | p0 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR0(#-9)

L11:    
;----------------------------------------------------------------------
; 231 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;ORM       #2,*(PMST)
        ;SSBX      FRCT
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        NOP
        MAC       *AR4+, *AR3+, A, A    ; |231| 
;----------------------------------------------------------------------
; 232 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |232| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |232| 
        MAC       *AR4+, *AR3+, A, A    ; |232| 

;----------------------------------------------------------------------
; 233 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |233| 
        STL       B,*AR5                ; |233| 
;----------------------------------------------------------------------
; 235 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |235| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |235| 
        MAC       *AR4+, *AR3+, A, A    ; |235| 

;----------------------------------------------------------------------
; 236 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |236| 
        STL       B,*AR1                ; |236| 
;----------------------------------------------------------------------
; 238 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |238| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |238| 
        MAC       *AR4, *AR3, A, A      ; |238| 
        DST       A,*SP(56)             ; |238| 

;----------------------------------------------------------------------
; 239 | *p1 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |239| 
        STL       A,*AR2                ; |239| 

;----------------------------------------------------------------------
; 241 | l_fin_sup -= NB_POS;                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(53),A
        ADD       #-8,A
        STL       A,*SP(53)
        LD        *SP(54),A
        ADD       #-8,A
        STL       A,*SP(54)
        LD        *SP(42),A
        ADD       #-8,A
        STL       A,*SP(42)

;----------------------------------------------------------------------
; 242 | l_fin_inf--;                                                           
;----------------------------------------------------------------------
        LD        *SP(43),A
        SUB       #1,A
        STL       A,*SP(43)

;----------------------------------------------------------------------
; 243 | ptr_hf += STEP;                                                        
;----------------------------------------------------------------------
        MAR       *+AR6(#5)
;----------------------------------------------------------------------
; 250 | ptr_hd = h;                                                            
;----------------------------------------------------------------------
        MAR       *AR7-
        LDM       BK,A
        ADD       #1,A
        BANZD     L9,*AR7(1)           
        STLM      A,BK
        NOP

;----------------------------------------------------------------------
; 251 | ptr_hf = ptr_hd + 2;                                                   
; 252 | l_fin_sup = MSIZE-1;                                                   
; 253 | l_fin_inf = l_fin_sup-(Word16)1;                                       
;----------------------------------------------------------------------
        ; OVM = SXM = FRCT = 1
        LD        *SP(52),A
        ADD       #1,A,A
        STL       A,*SP(58)
        LD        *SP(49),A
        ADD       #1,A,A
        STL       A,*SP(59)
        MVMM      SP,AR7
        LD        *SP(45),A
        ADD       #1,A,A
        STL       A,*SP(53)
        LD        *SP(50),A
        SUB       #1,A,A
        STL       A,*SP(54)
        LD        *SP(46),A
        SUB       #1,A,A
        STL       A,*SP(42)
        MAR       *+AR7(#4)
;----------------------------------------------------------------------
; 254 | for(k=0; k<NB_POS; k++) {                                              
;----------------------------------------------------------------------
        STM       #0,BK
        LD        #7,A
        STL       A,*SP(43)
L12:    
;----------------------------------------------------------------------
; 256 | p4 = rri2i4 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(58),*(AR5)
;----------------------------------------------------------------------
; 257 | p3 = rri1i3 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(59),*(AR1)
;----------------------------------------------------------------------
; 258 | p2 = rri0i2 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(53),*(AR2)
;----------------------------------------------------------------------
; 259 | p1 = rri1i4 + l_fin_inf;                                               
;----------------------------------------------------------------------
        MVDK      *SP(54),*(AR0)
;----------------------------------------------------------------------
; 260 | p0 = rri0i3 + l_fin_inf;                                               
; 262 | cor = 0;                                                               
; 263 | ptr_h1 = ptr_hd;                                                       
;----------------------------------------------------------------------
        MVDK      *SP(42),*(AR6)
;----------------------------------------------------------------------
; 264 | ptr_h2 =  ptr_hf;                                                      
;----------------------------------------------------------------------
        MVMM      AR7,AR4
        LD        #0,A
        DST       A,*SP(56)             ; |262| 
        MVMM      SP,AR3
        MAR       *+AR3(#2)

;----------------------------------------------------------------------
; 265 | for(i=k+(Word16)1; i<NB_POS; i++ ) {                                   
;----------------------------------------------------------------------
        LD        *(BK),B               
        SUB       #7,B,B               
        BC        L14,BGEQ             

        LDM       BK,A
        LD        #6,B
        SUB       A,B
        STLM      B,BRC
        ;SSBX      OVM
        NOP
        RPTB      L14-1
        
L13:    
;----------------------------------------------------------------------
; 267 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |267| 
        DST       A,*SP(56)             ; |267| 
;----------------------------------------------------------------------
; 268 | *p4 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,B              ; |268| 
        STL       B,*AR5                ; |268| 
;----------------------------------------------------------------------
; 270 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |270| 
;----------------------------------------------------------------------
; 271 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |271| 
        STL       B,*AR1                ; |271| 
;----------------------------------------------------------------------
; 273 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |273| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |273| 
        MAC       *AR4+, *AR3+, A, A    ; |273| 
;----------------------------------------------------------------------
; 274 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |274| 
        STL       B,*AR2                ; |274| 
;----------------------------------------------------------------------
; 276 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |276| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |276| 
        MAC       *AR4+, *AR3+, A, A    ; |276| 
;----------------------------------------------------------------------
; 277 | *p1 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |277| 
        STL       B,*AR0                ; |277| 
;----------------------------------------------------------------------
; 279 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |279| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |279| 
        MAC       *AR4+, *AR3+, A, A    ; |279| 
        DST       A,*SP(56)             ; |279| 
;----------------------------------------------------------------------
; 280 | *p0 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |280| 
        STL       B,*AR6                ; |280| 
;----------------------------------------------------------------------
; 282 | p4 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR5(#-9)
;----------------------------------------------------------------------
; 283 | p3 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR1(#-9)
;----------------------------------------------------------------------
; 284 | p2 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR2(#-9)
;----------------------------------------------------------------------
; 285 | p1 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR0(#-9)
;----------------------------------------------------------------------
; 286 | p0 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR6(#-9)
L14:    
;----------------------------------------------------------------------
; 288 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |288| 
;----------------------------------------------------------------------
; 289 | *p4 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |289| 
        STL       B,*AR5                ; |289| 
;----------------------------------------------------------------------
; 291 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |291| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |291| 
        MAC       *AR4+, *AR3+, A, A    ; |291| 
;----------------------------------------------------------------------
; 292 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        LD        A,B
        SFTL      B,#-16,B              ; |292| 
        STL       B,*AR1                ; |292| 

;----------------------------------------------------------------------
; 294 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |294| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |294| 
        MAC       *AR4, *AR3, A, A      ; |294| 
        DST       A,*SP(56)             ; |294| 
;----------------------------------------------------------------------
; 295 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |295| 
        STL       A,*AR2                ; |295| 
;----------------------------------------------------------------------
; 298 | l_fin_sup -= NB_POS;                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(58),A
        ADD       #-8,A
        STL       A,*SP(58)
        LD        *SP(59),A
        ADD       #-8,A
        STL       A,*SP(59)
        LD        *SP(53),A
        ADD       #-8,A
        STL       A,*SP(53)
;----------------------------------------------------------------------
; 299 | l_fin_inf--;                                                           
;----------------------------------------------------------------------
        LD        *SP(54),A
        SUB       #1,A
        STL       A,*SP(54)
        LD        *SP(42),A
        SUB       #1,A
        STL       A,*SP(42)

;----------------------------------------------------------------------
; 300 | ptr_hf += STEP;                                                        
;----------------------------------------------------------------------
        MAR       *+AR7(#5)
;----------------------------------------------------------------------
; 307 | ptr_hd = h;                                                            
;----------------------------------------------------------------------
        LDM       BK,A
        ADD       #1,A
        STLM      A,BK
        LD        *SP(43),A
        SUB       #1,A
        STLM      A,AR1
        NOP
        NOP
        BANZD     L12,*AR1(1)           
        NOP
        STL       A,*SP(43)

;----------------------------------------------------------------------
; 308 | ptr_hf = ptr_hd + 3;                                                   
; 309 | l_fin_sup = MSIZE-1;                                                   
; 310 | l_fin_inf = l_fin_sup-(Word16)1;                                       
;----------------------------------------------------------------------
        LDM       SP,A
        ADD       #5,A
        STLM      A,BK
        LD        *SP(50),A
        STL       A,*SP(54)
        LD        *SP(46),A
        STL       A,*SP(50)
        LD        *SP(52),A
        STL       A,*SP(46)
        LD        *SP(49),A
        STL       A,*SP(42)
        LD        *SP(45),A
        STL       A,*SP(43)
;----------------------------------------------------------------------
; 311 | for(k=0; k<NB_POS; k++) {                                              
;----------------------------------------------------------------------
        LD        #0,B
        STM       #7,BRC
        RPTB      L18-1
L15:    
;----------------------------------------------------------------------
; 313 | p4 = rri1i4 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(54),*(AR2)
;----------------------------------------------------------------------
; 314 | p3 = rri0i3 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(50),*(AR1)
;----------------------------------------------------------------------
; 315 | p2 = rri2i4 + l_fin_inf;                                               
;----------------------------------------------------------------------
        MVDK      *SP(46),*(AR5)
;----------------------------------------------------------------------
; 316 | p1 = rri1i3 + l_fin_inf;                                               
;----------------------------------------------------------------------
        MVDK      *SP(42),*(AR0)
;----------------------------------------------------------------------
; 317 | p0 = rri0i2 + l_fin_inf;                                               
; 319 | ptr_h1 = ptr_hd;                                                       
;----------------------------------------------------------------------
        MVDK      *SP(43),*(AR6)
;----------------------------------------------------------------------
; 320 | ptr_h2 =  ptr_hf;                                                      
;----------------------------------------------------------------------
        MVMD      BK,AR4
        MVMM      SP,AR3
        MAR       *+AR3(#2)
;----------------------------------------------------------------------
; 321 | cor = 0;                                                               
;----------------------------------------------------------------------
        LD        #0,A
        DST       A,*SP(56)             ; |321| 
;----------------------------------------------------------------------
; 322 | for(i=k+(Word16)1; i<NB_POS; i++ ) {                                   
;----------------------------------------------------------------------
        LD        *(BL),A               ; |322| 
        SUB       #7,A,A                ; |322| 
        BC        L17,AGEQ              ; |322| 

        LD        #6,A
        SUB       B,A
        STLM      A,AR7
L16:    
;----------------------------------------------------------------------
; 324 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |324| 
        DST       A,*SP(56)             ; |324| 
;----------------------------------------------------------------------
; 325 | *p4 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |325| 
        STL       A,*AR2                ; |325| 

;----------------------------------------------------------------------
; 327 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |327| 
        DST       A,*SP(56)             ; |327| 
;----------------------------------------------------------------------
; 328 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |328| 
        STL       A,*AR1                ; |328| 

;----------------------------------------------------------------------
; 330 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |330| 
        DST       A,*SP(56)             ; |330| 

;----------------------------------------------------------------------
; 331 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |331| 
        STL       A,*AR5                ; |331| 

;----------------------------------------------------------------------
; 333 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |333| 
        DST       A,*SP(56)             ; |333| 

;----------------------------------------------------------------------
; 334 | *p1 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |334| 
        STL       A,*AR0                ; |334| 

;----------------------------------------------------------------------
; 336 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |336| 
        DST       A,*SP(56)             ; |336| 

;----------------------------------------------------------------------
; 337 | *p0 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |337| 
        STL       A,*AR6                ; |337| 
;----------------------------------------------------------------------
; 339 | p4 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR2(#-9)
;----------------------------------------------------------------------
; 340 | p3 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR1(#-9)
;----------------------------------------------------------------------
; 341 | p2 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR5(#-9)
;----------------------------------------------------------------------
; 342 | p1 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR0(#-9)
;----------------------------------------------------------------------
; 343 | p0 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR6(#-9)
        ;RSBX      OVM
        ;NOP
        NOP
        MAR       *AR7-
        BANZ      L16,*AR7(1)           
L17:    
;----------------------------------------------------------------------
; 345 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |345| 
        DST       A,*SP(56)             ; |345| 
;----------------------------------------------------------------------
; 346 | *p4 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |346| 
        STL       A,*AR2                ; |346| 

;----------------------------------------------------------------------
; 348 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4, *AR3, A, A      ; |348| 
        DST       A,*SP(56)             ; |348| 

;----------------------------------------------------------------------
; 349 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |349| 
        STL       A,*AR1                ; |349| 

;----------------------------------------------------------------------
; 351 | l_fin_sup -= NB_POS;                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(54),A
        ADD       #-8,A
        STL       A,*SP(54)
        LD        *SP(50),A
        ADD       #-8,A
        STL       A,*SP(50)

;----------------------------------------------------------------------
; 352 | l_fin_inf--;                                                           
;----------------------------------------------------------------------
        LD        *SP(46),A
        SUB       #1,A
        STL       A,*SP(46)
        LD        *SP(42),A
        SUB       #1,A
        STL       A,*SP(42)
        LD        *SP(43),A
        SUB       #1,A
        STL       A,*SP(43)

;----------------------------------------------------------------------
; 353 | ptr_hf += STEP;                                                        
;----------------------------------------------------------------------
        LDM       BK,A
        ADD       #5,A
        STLM      A,BK
;----------------------------------------------------------------------
; 360 | ptr_hd = h;                                                            
;----------------------------------------------------------------------
        ADD       #1,B
L18:    
;----------------------------------------------------------------------
; 361 | ptr_hf = ptr_hd + 4;                                                   
; 362 | l_fin_sup = MSIZE-1;                                                   
; 363 | l_fin_inf = l_fin_sup-(Word16)1;                                       
;----------------------------------------------------------------------
        LD        *SP(47),A
        MVMM      SP,AR0
        STL       A,*SP(45)
        MVDK      *SP(44),*(BK)
        LD        *SP(48),A
        MAR       *+AR0(#6)
        STL       A,*SP(42)
        MVDK      *SP(51),*(AR6)

;----------------------------------------------------------------------
; 364 | for(k=0; k<NB_POS; k++) {                                              
;----------------------------------------------------------------------
        LD        #0,B
        LD        #7,A
        STL       A,*SP(43)
L19:    
;----------------------------------------------------------------------
; 366 | p3 = rri0i4 + l_fin_sup;                                               
;----------------------------------------------------------------------
        MVDK      *SP(45),*(AR1)

;----------------------------------------------------------------------
; 367 | p2 = rri2i3 + l_fin_inf;                                               
;----------------------------------------------------------------------
        MVMM      AR6,AR7

;----------------------------------------------------------------------
; 368 | p1 = rri1i2 + l_fin_inf;                                               
;----------------------------------------------------------------------
        MVDK      *SP(42),*(AR5)

;----------------------------------------------------------------------
; 369 | p0 = rri0i1 + l_fin_inf;                                               
; 371 | ptr_h1 = ptr_hd;                                                       
;----------------------------------------------------------------------
        MVMD      BK,AR2

;----------------------------------------------------------------------
; 372 | ptr_h2 =  ptr_hf;                                                      
;----------------------------------------------------------------------
        MVMM      AR0,AR4

        MVMM      SP,AR3
        MAR       *+AR3(#2)

;----------------------------------------------------------------------
; 373 | cor = 0;                                                               
;----------------------------------------------------------------------
        LD        #0,A
        DST       A,*SP(56)             ; |373| 

;----------------------------------------------------------------------
; 374 | for(i=k+(Word16)1; i<NB_POS; i++ ) {                                   
;----------------------------------------------------------------------
        LD        *(BL),A               ; |374| 
        SUB       #7,A,A                ; |374| 
        BC        L21,AGEQ              ; |374| 

        LD        #6,A
        SUB       B,A
        STLM      A,BRC
        NOP
        RPTB      L21-1
L20:    
;----------------------------------------------------------------------
; 376 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |376| 
        DST       A,*SP(56)             ; |376| 

;----------------------------------------------------------------------
; 377 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |377| 
        STL       A,*AR1                ; |377| 

;----------------------------------------------------------------------
; 379 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |379| 

;----------------------------------------------------------------------
; 380 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |380| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |380| 
        MAC       *AR4+, *AR3+, A, A    ; |380| 
        DST       A,*SP(56)             ; |380| 

;----------------------------------------------------------------------
; 381 | *p2 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |381| 
        STL       A,*AR7                ; |381| 
;----------------------------------------------------------------------
; 383 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |383| 
        DST       A,*SP(56)             ; |383| 
;----------------------------------------------------------------------
; 384 | *p1 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |384| 
        STL       A,*AR5                ; |384| 
;----------------------------------------------------------------------
; 386 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4+, *AR3+, A, A    ; |386| 
        DST       A,*SP(56)             ; |386| 

;----------------------------------------------------------------------
; 387 | *p0 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |387| 
        STL       A,*AR2                ; |387| 
;----------------------------------------------------------------------
; 389 | p3 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR1(#-9)

;----------------------------------------------------------------------
; 390 | p2 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR7(#-9)

;----------------------------------------------------------------------
; 391 | p1 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR5(#-9)

;----------------------------------------------------------------------
; 392 | p0 -= ldec;                                                            
;----------------------------------------------------------------------
        MAR       *+AR2(#-9)

L21:    
;----------------------------------------------------------------------
; 394 | cor = L_mac(cor, *ptr_h1, *ptr_h2); ptr_h1++; ptr_h2++;                
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        DLD       *SP(56),A
        ;SSBX      OVM
        ;NOP
        MAC       *AR4, *AR3, A, A      ; |394| 
        DST       A,*SP(56)             ; |394| 
;----------------------------------------------------------------------
; 395 | *p3 = extract_h(cor);                                                  
;----------------------------------------------------------------------
        SFTL      A,#-16,A              ; |395| 
        STL       A,*AR1                ; |395| 

;----------------------------------------------------------------------
; 397 | l_fin_sup -= NB_POS;                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(45),A
        ADD       #-8,A
        STL       A,*SP(45)

;----------------------------------------------------------------------
; 398 | l_fin_inf--;                                                           
;----------------------------------------------------------------------
        LD        *SP(42),A
        SUB       #1,A
        STL       A,*SP(42)
        LDM       BK,A
        SUB       #1,A
        STLM      A,BK
        MAR       *AR6-

;----------------------------------------------------------------------
; 399 | ptr_hf += STEP;                                                        
;----------------------------------------------------------------------
        MAR       *+AR0(#5)

;----------------------------------------------------------------------
; 401 | return;                                                                
;----------------------------------------------------------------------
        LD        *SP(43),A
        SUB       #1,A
        STLM      A,AR1
        ADD       #1,B
        BANZD     L19,*AR1(1)           ; |400| 
        NOP
        STL       A,*SP(43)

        ANDM      #-833,*(ST1)
        ANDM      #-4,*(PMST)
        FRAME     #60
        POPM      AR7
        POPM      AR6
        POPM      AR1
        RET

	.sect	".text"
;----------------------------------------------------------------------
; 424 | static Word16 D4i40_17_fast(/*(o) : Index of pulses positions.
;     |       */                                                               
; 425 | Word16 dn[],          /* (i)    : Correlations between h[] and Xn[].
;     |     */                                                                 
; 426 | Word16 rr[],          /* (i)    : Correlations of impulse response h[].
;     |     */                                                                 
; 427 | Word16 h[],           /* (i) Q12: Impulse response of filters.
;     |     */                                                                 
; 428 | Word16 cod[],         /* (o) Q13: Selected algebraic codeword.
;     |     */                                                                 
; 429 | Word16 y[],           /* (o) Q12: Filtered algebraic codeword.
;     |     */                                                                 
; 430 | Word16 *sign          /* (o)    : Signs of 4 pulses.
;     |     */                                                                 
; 431 | )                                                                      
;----------------------------------------------------------------------
_D4i40_17_fast:

        PSHM      AR1
        RSBX      OVM
        PSHM      AR6
        PSHM      FP
        ADDM      #-134,*(SP)
        NOP
        NOP
        MVMM      SP,FP
;----------------------------------------------------------------------
; 433 | Word16 i0, i1, i2, i3, ip0, ip1, ip2, ip3;                             
; 434 | Word16 i, j, ix, iy, track, trk, max;                                  
; 435 | Word16 prev_i0, i1_offset;                                             
; 436 | Word16 psk, ps, ps0, ps1, ps2, sq, sq2;                                
; 437 | Word16 alpk, alp, alp_16;                                              
; 438 | Word32 s, alp0, alp1, alp2;                                            
; 439 | Word16 *p0, *p1, *p2, *p3, *p4;                                        
; 440 | Word16 sign_dn[L_SUBFR], sign_dn_inv[L_SUBFR], *psign;                 
; 441 | Word16 tmp_vect[NB_POS];                                               
; 442 | Word16 *rri0i0, *rri1i1, *rri2i2, *rri3i3, *rri4i4;                    
; 443 | Word16 *rri0i1, *rri0i2, *rri0i3, *rri0i4;                             
; 444 | Word16 *rri1i2, *rri1i3, *rri1i4;                                      
; 445 | Word16 *rri2i3, *rri2i4;                                               
; 447 | Word16  *ptr_rri0i3_i4;                                                
; 448 | Word16  *ptr_rri1i3_i4;                                                
; 449 | Word16  *ptr_rri2i3_i4;                                                
; 450 | Word16  *ptr_rri3i3_i4;                                                
; 453 |  rri0i0 = rr;                                                          
;----------------------------------------------------------------------
        STL       A,*SP(90)
        LD        *FP(142),A
        STL       A,*SP(91)
        LD        *FP(141),A
        STL       A,*SP(92)
        LD        *FP(140),A
        STL       A,*SP(93)
        LD        *FP(139),A
        STL       A,*SP(94)
        LD        *FP(138),A
        STL       A,*SP(95)
;----------------------------------------------------------------------
; 454 | rri1i1 = rri0i0 + NB_POS;                                              
;----------------------------------------------------------------------
        ADD       #8,A,A                
        STL       A,*SP(96)
;----------------------------------------------------------------------
; 455 | rri2i2 = rri1i1 + NB_POS;                                              
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #16,A,A   
        ADD       #8,A,A         ; ****
        STL       A,*SP(97)
;----------------------------------------------------------------------
; 456 | rri3i3 = rri2i2 + NB_POS;                                              
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #24,A,A               ; |456| 
        ADD       #8,A,A          ; ****
        STL       A,*SP(98)

;----------------------------------------------------------------------
; 457 | rri4i4 = rri3i3 + NB_POS;                                              
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #32,A,A      
        ADD       #8,A,A          ; ****         
        STL       A,*SP(99)

;----------------------------------------------------------------------
; 458 | rri0i1 = rri4i4 + NB_POS;                                              
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #40,A,A             
        ADD       #8,A,A          ; ****  
        STL       A,*SP(100)

;----------------------------------------------------------------------
; 459 | rri0i2 = rri0i1 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #104,A,A   
        ADD       #64,A,A          ; ****           
        STL       A,*SP(101)
;----------------------------------------------------------------------
; 460 | rri0i3 = rri0i2 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #168,A,A      
        ADD       #64,A,A          ; ****        
        STL       A,*SP(102)
;----------------------------------------------------------------------
; 461 | rri0i4 = rri0i3 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #232,A,A              
        ADD       #64,A,A          ; ****
        STL       A,*SP(103)
;----------------------------------------------------------------------
; 462 | rri1i2 = rri0i4 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #296,A,A     
        ADD       #64,A,A          ; ****        
        STL       A,*SP(104)
;----------------------------------------------------------------------
; 463 | rri1i3 = rri1i2 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #360,A,A              
        ADD       #64,A,A          ; ****
        STL       A,*SP(105)
;----------------------------------------------------------------------
; 464 | rri1i4 = rri1i3 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #424,A,A              
        ADD       #64,A,A          ; ****
        STL       A,*SP(106)
;----------------------------------------------------------------------
; 465 | rri2i3 = rri1i4 + MSIZE;                                               
;----------------------------------------------------------------------
        ;LD        *SP(95),A
        ;ADD       #488,A,A             
        ADD       #64,A,A          ; ****
        STLM      A,BK
;----------------------------------------------------------------------
; 466 | rri2i4 = rri2i3 + MSIZE;                                               
; 472 | for (i=0; i<L_SUBFR; i++)                                              
;----------------------------------------------------------------------
        STM       #39,BRC
        MVMM      SP,AR2
        MVMM      SP,AR1
        MAR       *+AR2(#2)
        MAR       *+AR1(#42)
        LD        *SP(95),A
        ADD       #552,A,A              
        STL       A,*SP(107)
        LD        *SP(90),A
        SUB       #1,A,A
        STLM      A,AR3
        SSBX      SXM       ; ****
        SSBX      OVM
        RPTB      L25-1
L22:    
;----------------------------------------------------------------------
; 474 | if (dn[i] >= 0)                                                        
; 476 |   sign_dn[i] = MAX_16;                                                 
; 477 |   sign_dn_inv[i] = MIN_16;                                             
; 479 | else                                                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *+AR3(1),A            
        BC        L23,AGEQ               
;----------------------------------------------------------------------
; 481 | sign_dn[i] = MIN_16;                                                   
;----------------------------------------------------------------------
        ST        #-32768,*AR2          ; |481| 
;----------------------------------------------------------------------
; 482 | sign_dn_inv[i] = MAX_16;                                               
;----------------------------------------------------------------------
        ST        #32767,*AR1           ; |482| 
;----------------------------------------------------------------------
; 483 | dn[i] = negate(dn[i]);                                                 
;----------------------------------------------------------------------
        LD        *AR3,16,A             ; |483| 
        ;SSBX      OVM
        BD        L24                   ; |483| 
        NEG       A,A                   ; |483| 
        STH       A,*AR3                ; |483| 
L23:    
        ST        #32767,*AR2           ; |476| 
        ST        #-32768,*AR1          ; |477| 
L24:    
        MAR       *AR1+
        MAR       *AR2+
L25:    
;----------------------------------------------------------------------
; 491 | p0 = rri0i1;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(100),*(AR5)
;----------------------------------------------------------------------
; 492 | p1 = rri0i2;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(101),*(AR4)
;----------------------------------------------------------------------
; 493 | p2 = rri0i3;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(102),*(AR3)
;----------------------------------------------------------------------
; 494 | p3 = rri0i4;                                                           
; 496 | for(i0=0; i0<L_SUBFR; i0+=STEP)                                        
; 498 |   psign = sign_dn;                                                     
;----------------------------------------------------------------------
        MVMM      SP,AR0
        STM       #7,AR6
        MVDK      *SP(103),*(AR2)
        MAR       *+AR0(#2)
        SSBX      FRCT             ; ****
L26:    
;----------------------------------------------------------------------
; 499 | if (psign[i0] < 0) psign = sign_dn_inv;                                
; 501 | for(i1=1; i1<L_SUBFR; i1+=STEP)                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      SXM
        ;NOP
        LD        *AR0,A                
        BC        L27,AGEQ               
        MVMM      SP,AR1
        BD        L28                    
        MAR       *+AR1(#43)    
L27:    
        MVMM      SP,AR1
        MAR       *+AR1(#3)
L28:    
        STM       #7,BRC
        RPTB      L30-1
L29:    
;----------------------------------------------------------------------
; 503 | *p0++ = mult(*p0, psign[i1]);                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      FRCT
        LD        *AR1,16,A             ; |503| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR5                  ; |503| 
        SFTA      B,-16,A               ; |503| 
        STL       A,*AR5+
;----------------------------------------------------------------------
; 504 | *p1++ = mult(*p1, psign[i1+1]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(1),16,A          ; |504| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR4                  ; |504| 
        SFTA      B,-16,A               ; |504| 
        STL       A,*AR4+
;----------------------------------------------------------------------
; 505 | *p2++ = mult(*p2, psign[i1+2]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(2),16,A          ; |505| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR3                  ; |505| 
        SFTA      B,-16,A               ; |505| 
        STL       A,*AR3+
;----------------------------------------------------------------------
; 506 | *p3++ = mult(*p3, psign[i1+3]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(3),16,A          ; |506| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR2                  ; |506| 
        SFTA      B,-16,A               ; |506| 
        STL       A,*AR2+

        MAR       *+AR1(#5)
L30:    
        ;RSBX      OVM
        ;NOP
        ;NOP
        MAR       *AR6-
        BANZD     L26,*AR6(1)           
        MAR       *+AR0(#5)
;----------------------------------------------------------------------
; 510 | p0 = rri1i2;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(104),*(AR4)
;----------------------------------------------------------------------
; 511 | p1 = rri1i3;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(105),*(AR2)

;----------------------------------------------------------------------
; 512 | p2 = rri1i4;                                                           
; 514 | for(i1=1; i1<L_SUBFR; i1+=STEP)                                        
; 516 |   psign = sign_dn;                                                     
;----------------------------------------------------------------------
        MVMM      SP,AR5
        STM       #7,AR0
        MVDK      *SP(106),*(AR3)
        MAR       *+AR5(#3)
L31:    
;----------------------------------------------------------------------
; 517 | if (psign[i1] < 0) psign = sign_dn_inv;                                
; 519 | for(i2=2; i2<L_SUBFR; i2+=STEP)                                        
;----------------------------------------------------------------------
        LD        *AR5,A                ; |517| 
        BC        L32,AGEQ              ; |517|  
        MVMM      SP,AR1
        BD        L33                   ; |517| 
        MAR       *+AR1(#44)
      
L32:    
        MVMM      SP,AR1
        MAR       *+AR1(#4)
L33:    
        STM       #7,BRC
        RPTB      L35-1
L34:    
;----------------------------------------------------------------------
; 521 | *p0++ = mult(*p0, psign[i2]);                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      FRCT
        LD        *AR1,16,A             ; |521| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR4                  ; |521| 
        SFTA      B,-16,A               ; |521| 
        STL       A,*AR4+
;----------------------------------------------------------------------
; 522 | *p1++ = mult(*p1, psign[i2+1]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(1),16,A          ; |522| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR2                  ; |522| 
        SFTA      B,-16,A               ; |522| 
        STL       A,*AR2+
;----------------------------------------------------------------------
; 523 | *p2++ = mult(*p2, psign[i2+2]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(2),16,A          ; |523| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR3                  ; |523| 
        SFTA      B,-16,A               ; |523| 
        STL       A,*AR3+
        MAR       *+AR1(#5)

L35:    
        ;RSBX      OVM
        ;NOP
        NOP
        MAR       *AR0-
        BANZD     L31,*AR0(1)           ; |525| 
        MAR       *+AR5(#5)

;----------------------------------------------------------------------
; 527 | p0 = rri2i3;                                                           
;----------------------------------------------------------------------
        MVMD      BK,AR3
;----------------------------------------------------------------------
; 528 | p1 = rri2i4;                                                           
; 530 | for(i2=2; i2<L_SUBFR; i2+=STEP)                                        
; 532 |   psign = sign_dn;                                                     
;----------------------------------------------------------------------
        MVMM      SP,AR4
        STM       #7,AR5
        MVDK      *SP(107),*(AR2)
        MAR       *+AR4(#4)
L36:    
;----------------------------------------------------------------------
; 533 | if (psign[i2] < 0) psign = sign_dn_inv;                                
; 535 | for(i3=3; i3<L_SUBFR; i3+=STEP)                                        
;----------------------------------------------------------------------
        LD        *AR4,A                ; |533| 
        BC        L37,AGEQ              ; |533| 
        
        MVMM      SP,AR1
        BD        L38                   ; |533| 
        MAR       *+AR1(#45)
        
L37:    
        MVMM      SP,AR1
        MAR       *+AR1(#5)
L38:    
;** 533	-----------------------    #pragma MUST_ITERATE(8, 8, 8)
;**  	-----------------------    #pragma LOOP_FLAGS(4096u)
;**  	-----------------------    U$124 = psign;
;**	-----------------------g22:
;**  	-----------------------    L$7 = 7;
;**	-----------------------g145:
        STM       #7,BRC
        RPTB      L40-1
        ; loop starts
L39:    
;** 537	-----------------------    A$26 = _smpy(*p0, *U$124);
;** 537	-----------------------    *p0++ = A$26;
;** 538	-----------------------    A$25 = _smpy(*p1, U$124[1]);
;** 538	-----------------------    *p1++ = A$25;
;** 539	-----------------------    U$124 += 5;
;** 539	-----------------------    if ( --L$7 != -1 ) goto g145;

;----------------------------------------------------------------------
; 537 | *p0++ = mult(*p0, psign[i3]);                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      FRCT
        LD        *AR1,16,A             ; |537| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR3                  ; |537| 
        SFTA      B,-16,A               ; |537| 
        STL       A,*AR3+

;----------------------------------------------------------------------
; 538 | *p1++ = mult(*p1, psign[i3+1]);                                        
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR1(1),16,A          ; |538| 
        ;SSBX      OVM
        ;NOP
        MPYA      *AR2                  ; |538| 
        SFTA      B,-16,A               ; |538| 
        STL       A,*AR2+

        MAR       *+AR1(#5)
        ; loop ends ; |539| 
L40:    
;** 540	-----------------------    U$119 += 5;
;** 540	-----------------------    if ( (--L$6) != (-1) ) goto g20;

;----------------------------------------------------------------------
; 548 | psk = -1;                                                              
; 549 | alpk = 1;                                                              
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        NOP
        MAR       *AR5-
        BANZD     L36,*AR5(1)           ; |540| 
        MAR       *+AR4(#5)

;** 551	-----------------------    ptr_rri0i3_i4 = rri0i3;
;** 552	-----------------------    ptr_rri1i3_i4 = rri1i3;
;** 553	-----------------------    ptr_rri2i3_i4 = rri2i3;
;** 554	-----------------------    ptr_rri3i3_i4 = rri3i3;
;**  	-----------------------    #pragma MUST_ITERATE(2, 2, 2)
;**  	-----------------------    #pragma LOOP_FLAGS(5120u)
;** 548	-----------------------    psk = (-1);
;** 549	-----------------------    alpk = 1;
;** 558	-----------------------    ip0 = 0;
;** 558	-----------------------    ip1 = 1;
;** 558	-----------------------    ip2 = 2;
;** 558	-----------------------    ip3 = 3;
;** 558	-----------------------    ps = iy = ix = 0;
;** 561	-----------------------    track = 3;
;** 508	-----------------------    i0 = 40;

;----------------------------------------------------------------------
; 551 | ptr_rri0i3_i4 = rri0i3;                                                
;----------------------------------------------------------------------
        LD        *SP(102),A
        STL       A,*SP(108)

;----------------------------------------------------------------------
; 552 | ptr_rri1i3_i4 = rri1i3;                                                
;----------------------------------------------------------------------
        LD        *SP(105),A
        STL       A,*SP(109)

;----------------------------------------------------------------------
; 553 | ptr_rri2i3_i4 = rri2i3;                                                
;----------------------------------------------------------------------
        MVKD      *(BK),*SP(110)

;----------------------------------------------------------------------
; 554 | ptr_rri3i3_i4 = rri3i3;                                                
;----------------------------------------------------------------------
        LD        *SP(98),A
        STL       A,*SP(111)

        LD        #-1,A
        STL       A,*SP(112)

        LD        #1,A
        STL       A,*SP(113)

;----------------------------------------------------------------------
; 558 | ip0=0; ip1=1; ip2=2; ip3=3; ix=0; iy=0; ps=0;                          
;----------------------------------------------------------------------
        ;LD        #0,A
        ;STL       A,*SP(114)
        ST        #0,*SP(114)
        
        ;LD        #1,A
        ;STL       A,*SP(115)
        ST        #1,*SP(114)
        
        ;LD        #2,A
        ;STL       A,*SP(116)
        ST        #2,*SP(114)
        
        ;LD        #3,A
        ;STL       A,*SP(117)
        ST        #3,*SP(114)
        
        LD        #0,A
        STL       A,*SP(120)
        STL       A,*SP(119)
        STL       A,*SP(118)

;----------------------------------------------------------------------
; 561 | for (track=3, trk=0; track<5; track++, trk++)                          
;----------------------------------------------------------------------
        LD        #3,A
        STL       A,*SP(121)
        STM       #40,AR1
L41:    

;----------------------------------------------------------------------
; 567 | sq = -1;                                                               
;----------------------------------------------------------------------
        STM       #-1,AR6

;----------------------------------------------------------------------
; 568 | alp = 1;                                                               
;----------------------------------------------------------------------
        LD        #1,A
        STL       A,*SP(122)

;----------------------------------------------------------------------
; 572 | prev_i0  = -1;                                                         
; 574 | for (i=0; i<2; i++)                                                    
;----------------------------------------------------------------------
        LD        #-1,A
        STL       A,*SP(98)
        LD        #2,A
        STL       A,*SP(105)
L42:    
        LD        *SP(90),A
        ADD       #2,A,A
        STLM      A,AR2
        NOP
;----------------------------------------------------------------------
; 576 | max = -1;                                                              
;----------------------------------------------------------------------
        STM       #-1,AR4
;----------------------------------------------------------------------
; 578 | for (j=2; j<L_SUBFR; j+=STEP)                                          
;----------------------------------------------------------------------
        LD        #2,B
        STM       #7,BRC
        RPTB      L45-1
L43:    
;----------------------------------------------------------------------
; 580 | if ((sub(dn[j], max) > 0) && (sub(prev_i0,j) != 0))                    
;----------------------------------------------------------------------
        MVDK      *AR2,*(AR3)
        LD        *(AR3),16,A           ; |580| 
        ;SSBX      OVM
        SUB       *(AR4),16,A,A         ; |580| 
        SFTA      A,-16,A               ; |580| 
        LD        *(AL),A               ; |580| 
        BC        L44,ALEQ              ; |580| 
   
        ;RSBX      OVM
        LD        *SP(98),A
        LD        *(AL),16,A            ; |580| 
        ;SSBX      OVM
        SUB       *(BL),16,A,A          ; |580| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |580| 
        LD        *(AL),A               ; |580| 
        BC        L44,AEQ               ; |580| 
;----------------------------------------------------------------------
; 582 | max = dn[j];                                                           
;----------------------------------------------------------------------
        MVMM      AR3,AR4
;----------------------------------------------------------------------
; 583 | i0 = j;                                                                
;----------------------------------------------------------------------
        STLM      B,AR1
        NOP
L44:    
        ;RSBX      OVM
        MAR       *+AR2(#5)
        ADD       #5,B
L45:    
;----------------------------------------------------------------------
; 586 | prev_i0 = i0;                                                          
; 588 | j = mult(i0, 6554);        /* j = i0/5 */                              
; 589 | p0 = rri2i2 + j;                                                       
;----------------------------------------------------------------------
        MVKD      *(AR1),*SP(98)

;----------------------------------------------------------------------
; 591 | ps1 = dn[i0];                                                          
;----------------------------------------------------------------------
        LD        *SP(90),A
        LD        *SP(98),B
        ADD       B,A                   ; |591| 
        STLM      A,AR2
        NOP
        NOP
        LD        *AR2,A
        STL       A,*SP(102)

;----------------------------------------------------------------------
; 592 | alp1 = L_mult(*p0, _1_4);                                              
;----------------------------------------------------------------------
        SSBX      FRCT
        STLM      B,T
        LD        #6554,16,A            ; |592| 
        SSBX      OVM
        LD        *SP(97),B
        MPYA      A                     ; |592| 
        RSBX      OVM
        SFTA      A,-16,A               ; |592| 
        STLM      A,AR3
        ADD       B,A                   ; |592| 
        STLM      A,AR2
        SSBX      OVM
        NOP
        MPY       *AR2,#8192,B          ; |592| 
        DST       B,*SP(124)            ; |592| 

;----------------------------------------------------------------------
; 596 | p0 = ptr_rri2i3_i4 + shl(j, 3);                                        
; 597 | p1 = ptr_rri3i3_i4;                                                    
;----------------------------------------------------------------------
        RSBX      OVM
        RSBX      FRCT
        ST        #3,*SP(0)             ; |596| 
        CALLD     #_shl                 ; |596| 
        NOP
        LDM       AR3,A
        ; call occurs [#_shl] ; |596| 
        RSBX      OVM
        LD        *SP(110),B
        ADD       *(BL),A
        STLM      A,AR0
        NOP
;----------------------------------------------------------------------
; 599 | for (i1=track; i1<L_SUBFR; i1+=STEP)                                   
;----------------------------------------------------------------------
        MVDK      *SP(121),*(AR2)

        LDM       AR2,A
        LD        *SP(90),B
        ADD       *(BL),A
        STLM      A,AR5
        NOP
        MVDK      *SP(111),*(AR4)

;----------------------------------------------------------------------
; 601 | ps2 = add(ps1, dn[i1]);       /* index increment = STEP */             
;----------------------------------------------------------------------
        LD        #39,A
        LDM       AR2,B
        SUB       B,A                  
        STLM      A,AR3
L46:    
;----------------------------------------------------------------------
; 604 | alp2 = L_mac(alp1, *p0++, _1_2);                                       
; 605 | alp2 = L_mac(alp2, *p1++, _1_4);                                       
; 607 | sq2 = mult(ps2, ps2);                                                  
; 608 | alp_16 = round(alp2);                                                  
; 610 | s = L_msu(L_mult(alp,sq2),sq,alp_16);                                  
;----------------------------------------------------------------------
        SSBX      SXM
        LD        #16384,B
        LD        *AR0+,T
        DLD       *SP(124),A
        ORM       #2,*(PMST)
        SSBX      FRCT
        SSBX      OVM
        ORM       #2,*(PMST)
        MAC       *(BL), A              ; |604| 
        RSBX      OVM
        LD        *AR4+,T
        LD        #8192,B
        SFTA      A,8                   ; |604| 
        SSBX      OVM
        SFTA      A,-8                  ; |604| 
        MAC       *(BL), A              ; |604| 

;----------------------------------------------------------------------
; 611 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |611| 
        ;SFTA      A,-8                  ; |611| 
        ;SSBX      OVM
        ADD       #1,#15,A,A            ; |611| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |611| 
        STLM      A,BK
        LD        *SP(102),A
        LD        *(AL),16,A            ; |611| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR5,16,A,A           ; |611| 
        SFTA      A,-16,B               ; |611| 
        ;RSBX      OVM
        LD        *(BL),16,A            ; |611| 
        STLM      B,T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |611| 
        SFTA      A,-16,A               ; |611| 
        STL       A,*SP(126)
        STLM      A,T
        LD        *SP(122),A
        MPY       *(AL),A               
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                  
        ;SFTA      A,-8                  
        ;SSBX      OVM
        MVMD      AR6,T
        MAS       *(BK), A              
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   
        ;SFTA      A,-8                  
        BC        L47,ALEQ              

;----------------------------------------------------------------------
; 613 | sq = sq2;                                                              
;----------------------------------------------------------------------
        MVDK      *SP(126),*(AR6)
;----------------------------------------------------------------------
; 614 | ps = ps2;                                                              
;----------------------------------------------------------------------
        STL       B,*SP(120)
;----------------------------------------------------------------------
; 615 | alp = alp_16;                                                          
;----------------------------------------------------------------------
        MVKD      *(BK),*SP(122)
;----------------------------------------------------------------------
; 616 | ix = i0;                                                               
;----------------------------------------------------------------------
        MVKD      *(AR1),*SP(118)
;----------------------------------------------------------------------
; 617 | iy = i1;                                                               
;----------------------------------------------------------------------
        LDM       AR2,A
        STL       A,*SP(119)
L47:    
        MAR       *+AR3(#-5)
        LD        *(AR3),A              
        MAR       *+AR2(#5)
        BCD       L46,AGEQ              
        MAR       *+AR5(#5)

        MVDK      *SP(105),*(AR2)
        BANZD     L42,*+AR2(-1)          
        
        MVKD      *(AR2),*SP(105)
;----------------------------------------------------------------------
; 622 | i0 = ix;                                                               
;----------------------------------------------------------------------
        LD        *SP(118),A
        STL       A,*SP(102)
;----------------------------------------------------------------------
; 623 | i1 = iy;                                                               
;----------------------------------------------------------------------
        LD        *SP(119),A
        STL       A,*SP(105)
;----------------------------------------------------------------------
; 624 | i1_offset = shl(mult(i1, 6554), 3);       /* j = 8*(i1/5) */           
;----------------------------------------------------------------------
        LD        #6554,16,A            ; |624| 
        LD        *SP(105),T
        SSBX      OVM
        ST        #3,*SP(0)             ; |624| 
        MPYA      A                     ; |624| 
        RSBX      FRCT
        RSBX      OVM
        SFTA      A,-16,A               ; |624| 
        CALLD     #_shl                 ; |624| 
        STLM      A,AR1
        NOP

;----------------------------------------------------------------------
; 630 | ps0 = ps;                                                              
;----------------------------------------------------------------------
        LD        *SP(120),A
        STL       A,*SP(126)

;----------------------------------------------------------------------
; 631 | alp0 = L_mult(alp, _1_4);                                              
; 633 | sq = -1;                                                               
; 634 | alp = 1;                                                               
;----------------------------------------------------------------------
        SSBX      FRCT		; 2005.8.23 dzc chg it and crrected
        ;SSBX      OVM
        LD        *SP(122),A
        MPY       *(AL),#8192,A         ; |631| 
        DST       A,*SP(124)            ; |631| 

;----------------------------------------------------------------------
; 638 | p0 = rri1i2 + mult(i0, 6554);                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #6554,16,A            ; |638| 
        ;SSBX      SXM
        LD        *SP(102),T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |638| 
        SFTA      A,-16,A               ; |638| 
        ;RSBX      OVM
        LD        *SP(104),B
        ADD       B,A                   ; |638| 
        STLM      A,AR3

;----------------------------------------------------------------------
; 639 | p1 = ptr_rri1i3_i4 + mult(i1, 6554);                                   
;----------------------------------------------------------------------
        LD        *SP(109),B
        LDM       AR1,A
        ADD       *(BL),A
        STLM      A,AR4
        NOP
;----------------------------------------------------------------------
; 640 | p2 = rri1i1;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(96),*(AR2)
;----------------------------------------------------------------------
; 641 | p3 = tmp_vect;                                                         
; 643 | for (i3=1; i3<L_SUBFR; i3+=STEP)                                       
;----------------------------------------------------------------------
        STM       #7,BRC
        MVMM      SP,AR1
        MAR       *+AR1(#82)
        RPTB      L49-1
L48:    
;----------------------------------------------------------------------
; 646 | s = L_mult(*p0, _1_4);        p0 += NB_POS;                            
;----------------------------------------------------------------------
        ;SSBX      OVM
        ;NOP
        MPY       *AR3,#8192,A          
        MAR       *+AR3(#8)

;----------------------------------------------------------------------
; 647 | s = L_mac(s, *p1, _1_4);      p1 += NB_POS;                            
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   
        LD        #8192,B
        LD        *AR4,T
        ;SFTA      A,-8                  
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAR       *+AR4(#8)
        MAC       *(BL), A              

;----------------------------------------------------------------------
; 648 | s = L_mac(s, *p2++, _1_8);                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |648| 
        LD        *AR2+,T
        LD        #4096,B
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |648| 
        MAC       *(BL), A              ; |648| 

;----------------------------------------------------------------------
; 649 | *p3++ = round(s);                                                      
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                  ; |649| 
        ;SSBX      OVM
        ;SFTA      A,-8                 ; |649| 
        ADD       #1,#15,A,A            ; |649| 
        STH       A,*AR1+               ; |649| 
        ; loop ends ; |650| 
L49:    
;----------------------------------------------------------------------
; 654 | p0 = rri0i2 + mult(i0, 6554);                                          
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(102),T
        LD        #6554,16,A            ; |654| 
        ;SSBX      OVM
        LD        *SP(101),B
        MPYA      A                     ; |654| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |654| 
        ADD       B,A                   ; |654| 
        STL       A,*SP(127)

;----------------------------------------------------------------------
; 655 | p1 = ptr_rri0i3_i4 + mult(i1, 6554);                                   
;----------------------------------------------------------------------
        LD        *SP(105),T
        LD        #6554,16,A            ; |655| 
        ;SSBX      OVM
        LD        *SP(108),B
        MPYA      A                     ; |655| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |655| 
        ADD       B,A                   ; |655| 
        STL       A,*FP(128)

;----------------------------------------------------------------------
; 656 | p2 = rri0i0;                                                           
;----------------------------------------------------------------------
        LD        *SP(95),A
        SUB       #1,A,A                ; |656| 
        STL       A,*FP(129)

;----------------------------------------------------------------------
; 657 | p3 = rri0i1;                                                           
;----------------------------------------------------------------------
        LD        *SP(90),A
        STL       A,*FP(130)
        ADD       #1,A,A
        STLM      A,AR5
        NOP
        MVDK      *SP(100),*(AR3)

        STM       #-1,BK

        STM       #1,AR2

;----------------------------------------------------------------------
; 659 | for (i2=0; i2<L_SUBFR; i2+=STEP)                                       
;----------------------------------------------------------------------
        STM       #0,AR4
        LD        #7,A
        STL       A,*SP(98)
L50:    
;----------------------------------------------------------------------
; 661 | ps1 = add(ps0, dn[i2]);         /* index increment = STEP */           
;----------------------------------------------------------------------
        LD        *SP(126),A
        LD        *(AL),16,A            ; |661| 
        ;SSBX      OVM
        MVDK      *FP(130),*(AR1)
        ADD       *AR1,16,A,A           ; |661| 
        SFTA      A,-16,A               ; |661| 
        STL       A,*SP(122)

;----------------------------------------------------------------------
; 664 | alp1 = L_mac(alp0, *p0, _1_8);       p0 += NB_POS;                     
; 665 | alp1 = L_mac(alp1, *p1, _1_8);       p1 += NB_POS;                     
; 666 | alp1 = L_mac(alp1, *p2++, _1_16);                                      
;----------------------------------------------------------------------
        MVDK      *SP(127),*(AR1)
        ;RSBX      OVM
        LD        #4096,B
        LD        *AR1,T
        DLD       *SP(124),A
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A               ; |664| 
        ;RSBX      OVM
        MVDK      *FP(128),*(AR1)
        ;SFTA      A,8                   ; |664| 
        LD        #4096,B
        LD        *AR1,T
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |664| 
        MAC       *(BL), A               ; |664| 
        ;RSBX      OVM
        MVDK      *FP(129),*(AR1)
        ;SFTA      A,8                   ; |664| 
        LD        *+AR1(1),T
        LD        #2048,B
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |664| 
        MAC       *(BL), A               ; |664| 
        DST       A,*FP(132)             ; |664| 
        MVKD      *(AR1),*FP(129)

;----------------------------------------------------------------------
; 670 | p4 = tmp_vect;                                                         
;----------------------------------------------------------------------
        MVMM      SP,AR6
        MAR       *+AR6(#82)

;----------------------------------------------------------------------
; 672 | for (i3=1; i3<L_SUBFR; i3+=STEP)                                       
; 674 |   ps2 = add(ps1, dn[i3]);       /* index increment = STEP */           
;----------------------------------------------------------------------
        STM       #1,AR0
        STM       #7,BRC
        RPTB      L53-1

L51:    
;----------------------------------------------------------------------
; 677 | alp2 = L_mac(alp1, *p3++, _1_8);                                       
; 678 | alp2 = L_mac(alp2, *p4++, _1_2);                                       
; 680 | sq2 = mult(ps2, ps2);                                                  
; 681 | alp_16 = round(alp2);                                                  
; 683 | s = L_msu(L_mult(alp,sq2),sq,alp_16);                                  
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR3+,T
        LD        #4096,B
        DLD       *FP(132),A
        ;SSBX      OVM
        MAC       *(BL), A              ; |677| 
        ;RSBX      OVM
        LD        *AR6+,T
        LD        #16384,B
        ;SFTA      A,8                   ; |677| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |677| 
        MAC       *(BL), A              ; |677| 

;----------------------------------------------------------------------
; 684 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |684| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |684| 
        ADD       #1,#15,A,A            ; |684| 
        SFTA      A,-16,A               ; |684| 
        STLM      A,AR1
        ;RSBX      OVM
        LD        *SP(122),A
        LD        *(AL),16,A            ; |684| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR5,16,A,A           ; |684| 
        ;RSBX      OVM
        SFTA      A,-16,B               ; |684| 
        LD        *(BL),16,A            ; |684| 
        STLM      B,T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |684| 
        SFTA      A,-16,A               ; |684| 
        STLM      A,T
        MPY       *(AR2),B              ; |684| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      B,8                   ; |684| 
        MVMD      BK,T
        ;SFTA      B,-8                  ; |684| 
        ;SSBX      OVM
        MAS       *(AR1), B             ; |684| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      B,8                   ; |684| 
        ;SFTA      B,-8                  ; |684| 
        BC        L52,BLEQ              ; |684| 

;----------------------------------------------------------------------
; 686 | sq = sq2;                                                              
;----------------------------------------------------------------------
        STLM      A,BK

;----------------------------------------------------------------------
; 687 | alp = alp_16;                                                          
;----------------------------------------------------------------------
        MVMM      AR1,AR2

;----------------------------------------------------------------------
; 688 | ix = i2;                                                               
;----------------------------------------------------------------------
        MVKD      *(AR4),*SP(118)
;----------------------------------------------------------------------
; 689 | iy = i3;                                                               
;----------------------------------------------------------------------
        MVKD      *(AR0),*SP(119)
L52:    
        MAR       *+AR0(#5)
        MAR       *+AR5(#5)
        ; loop ends ; |691| 
L53:    
        MAR       *+AR5(#-40)
        ;RSBX      OVM
        LD        *FP(130),A
        ADD       #5,A
        STL       A,*FP(130)
        MAR       *+AR4(#5)

        LD        *FP(128),A
        ADD       #8,A
        STL       A,*FP(128)

        LD        *SP(127),A
        ADD       #8,A
        STL       A,*SP(127)

;----------------------------------------------------------------------
; 698 | s = L_msu(L_mult(alpk,sq),psk,alp);                                    
;----------------------------------------------------------------------
        LD        *SP(98),A
        SUB       #1,A
        STLM      A,AR1
        NOP
        NOP
        BANZD     L50,*AR1(1)           ; |692| 
        NOP
        STL       A,*SP(98)
;----------------------------------------------------------------------
; 699 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;SSBX      OVM
        MVMD      BK,T
        LD        *SP(113),A
        MPY       *(AL),A               ; |699| 
        ;RSBX      OVM
        LD        *SP(112),T
        ;SFTA      A,8                   ; |699| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |699| 
        MAS       *(AR2), A             ; |699| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |699| 
        ;SFTA      A,-8                  ; |699| 
        BC        L54,ALEQ              ; |699| 

;----------------------------------------------------------------------
; 701 | psk = sq;                                                              
;----------------------------------------------------------------------
        MVKD      *(BK),*SP(112)

;----------------------------------------------------------------------
; 702 | alpk = alp;                                                            
;----------------------------------------------------------------------
        MVKD      *(AR2),*SP(113)

;----------------------------------------------------------------------
; 703 | ip2 = i0;                                                              
;----------------------------------------------------------------------
        LD        *SP(102),A
        STL       A,*SP(116)

;----------------------------------------------------------------------
; 704 | ip3 = i1;                                                              
;----------------------------------------------------------------------
        LD        *SP(105),A
        STL       A,*SP(117)

;----------------------------------------------------------------------
; 705 | ip0 = ix;                                                              
;----------------------------------------------------------------------
        LD        *SP(118),A
        STL       A,*SP(114)

;----------------------------------------------------------------------
; 706 | ip1 = iy;                                                              
;----------------------------------------------------------------------
        LD        *SP(119),A
        STL       A,*SP(115)
L54:    
;----------------------------------------------------------------------
; 713 | sq = -1;                                                               
;----------------------------------------------------------------------
        STM       #-1,AR5

;----------------------------------------------------------------------
; 714 | alp = 1;                                                               
;----------------------------------------------------------------------
        STM       #1,AR6

;----------------------------------------------------------------------
; 718 | prev_i0  = -1;                                                         
; 720 | for (i=0; i<2; i++)                                                    
; 722 |   max = -1;                                                            
;----------------------------------------------------------------------
        LD        #-1,A
        STL       A,*SP(105)
        LD        #1,A
        STL       A,*SP(98)
L55:    
;----------------------------------------------------------------------
; 724 | for (j=track; j<L_SUBFR; j+=STEP)                                      
;----------------------------------------------------------------------
        LD        *SP(90),B
        LD        *SP(121),A
        ADD       *(BL),A,B
        STLM      B,AR2

;----------------------------------------------------------------------
; 726 | if ((sub(dn[j], max) > 0) && (sub(prev_i0,j) != 0))                    
;----------------------------------------------------------------------
        LD        #39,B
        SUB       A,B                   ; |726| 
        STLM      B,AR1
        NOP

        STM       #-1,AR4
L56:    

        MVDK      *AR2,*(AR3)
        LD        *(AR3),16,B           ; |726| 
        ;SSBX      OVM
        SUB       *(AR4),16,B,B         ; |726| 
        SFTA      B,-16,B               ; |726| 
        LD        *(BL),B               ; |726| 
        BC        L57,BLEQ              ; |726| 
 
        ;RSBX      OVM
        LD        *SP(105),B
        LD        *(BL),16,B            ; |726| 
        ;SSBX      OVM
        SUB       *(AL),16,B,B          ; |726| 
        ;RSBX      OVM
        SFTA      B,-16,B               ; |726| 
        LD        *(BL),B               ; |726| 
        BC        L57,BEQ               ; |726| 

;----------------------------------------------------------------------
; 728 | max = dn[j];                                                           
;----------------------------------------------------------------------
        MVMM      AR3,AR4

;----------------------------------------------------------------------
; 729 | i0 = j;                                                                
;----------------------------------------------------------------------
        STL       A,*SP(102)
L57:    

        MAR       *+AR1(#-5)
        LD        *(AR1),B              ; |731| 
        ;RSBX      OVM
        MAR       *+AR2(#5)
        BCD       L56,BGEQ              ; |731| 
        ADD       #5,A

;----------------------------------------------------------------------
; 732 | prev_i0 = i0;                                                          
; 734 | j = mult(i0, 6554);        /* j = i0/5 */                              
; 735 | p0 = ptr_rri3i3_i4 + j;                                                
;----------------------------------------------------------------------
        LD        *SP(102),A
        STL       A,*SP(105)
;----------------------------------------------------------------------
; 737 | ps1 = dn[i0];                                                          
;----------------------------------------------------------------------
        LD        *SP(105),B
        LD        *SP(90),A
        ADD       B,A                   ; |737| 
        STLM      A,AR1
        NOP
        NOP
        MVDK      *AR1,*(BK)

;----------------------------------------------------------------------
; 738 | alp1 = L_mult(*p0, _1_4);                                              
;----------------------------------------------------------------------
        STLM      B,T
        LD        #6554,16,A            ; |738| 
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |738| 
        SFTA      A,-16,A               ; |738| 
        STLM      A,AR2
        ;RSBX      OVM
        LDM       AR2,B
        LD        *SP(111),A
        ADD       A,B                   ; |738| 
        STLM      B,AR1
        ;SSBX      OVM
        NOP
        NOP
        MPY       *AR1,#8192,B          ; |738| 
        DST       B,*SP(124)            ; |738| 

;----------------------------------------------------------------------
; 742 | p0 = ptr_rri0i3_i4 + j;                                                
;----------------------------------------------------------------------
        LD        *SP(108),B
        ;RSBX      OVM
        ADD       *(AR2),B,A
        STLM      A,AR0
        NOP

;----------------------------------------------------------------------
; 743 | p1 = rri0i0;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(90),*(AR1)
        MVDK      *SP(95),*(AR4)

;----------------------------------------------------------------------
; 745 | for (i1=0; i1<L_SUBFR; i1+=STEP)                                       
; 747 |   ps2 = add(ps1, dn[i1]);       /* index increment = STEP */           
;----------------------------------------------------------------------
        STM       #7,BRC
        STM       #0,AR2
        RPTB      L60-1

L58:    

;----------------------------------------------------------------------
; 750 | alp2 = L_mac(alp1, *p0, _1_2);       p0 += NB_POS;                     
; 751 | alp2 = L_mac(alp2, *p1++, _1_4);                                       
; 753 | sq2 = mult(ps2, ps2);                                                  
; 754 | alp_16 = round(alp2);                                                  
; 756 | s = L_msu(L_mult(alp,sq2),sq,alp_16);                                  
;----------------------------------------------------------------------
        DLD       *SP(124),A
        LD        *AR0,T
        LD        #16384,B
        ;SSBX      OVM
        MAC       *(BL), A              ; |750| 
        ;RSBX      OVM
        LD        *AR4+,T
        LD        #8192,B
        ;SFTA      A,8                   ; |750| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |750| 
        MAC       *(BL), A              ; |750| 

;----------------------------------------------------------------------
; 757 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |757| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |757| 
        ADD       #1,#15,A,A            ; |757| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |757| 
        STLM      A,AR3
        LD        *(BK),16,A            ; |757| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR1,16,A,A           ; |757| 
        ;RSBX      OVM
        SFTA      A,-16,B               ; |757| 
        LD        *(BL),16,A            ; |757| 
        ;SSBX      OVM
        STLM      B,T
        NOP
        MPYA      A                     ; |757| 
        SFTA      A,-16,A               ; |757| 
        STL       A,*SP(126)
        STLM      A,T
        MPY       *(AR6),A              ; |757| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |757| 
        ;SSBX      OVM
        MVMD      AR5,T
        ;SFTA      A,-8                  ; |757| 
        MAS       *(AR3), A             ; |757| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |757| 
        ;SFTA      A,-8                  ; |757| 
        BC        L59,ALEQ              ; |757| 

;----------------------------------------------------------------------
; 759 | sq = sq2;                                                              
;----------------------------------------------------------------------
        MVDK      *SP(126),*(AR5)

;----------------------------------------------------------------------
; 760 | ps = ps2;                                                              
;----------------------------------------------------------------------
        STL       B,*SP(120)
;----------------------------------------------------------------------
; 761 | alp = alp_16;                                                          
;----------------------------------------------------------------------
        MVMM      AR3,AR6
;----------------------------------------------------------------------
; 762 | ix = i0;                                                               
;----------------------------------------------------------------------
        LD        *SP(102),A
        STL       A,*SP(118)
;----------------------------------------------------------------------
; 763 | iy = i1;                                                               
;----------------------------------------------------------------------
        MVKD      *(AR2),*SP(119)
L59:    
        MAR       *+AR2(#5)
        MAR       *+AR1(#5)

        MAR       *+AR0(#8)
        ; loop ends ; |765| 
L60:    

        LD        *SP(98),A
        SUB       #1,A
        STLM      A,AR1
        NOP
        NOP
        BANZD     L55,*AR1(1)           ; |766| 
        NOP
        STL       A,*SP(98)

;----------------------------------------------------------------------
; 768 | i0 = ix;                                                               
;----------------------------------------------------------------------
        MVDK      *SP(118),*(AR1)
;----------------------------------------------------------------------
; 769 | i1 = iy;                                                               
;----------------------------------------------------------------------
        LD        *SP(119),A
        STL       A,*SP(102)
;----------------------------------------------------------------------
; 770 | i1_offset = shl(mult(i1, 6554), 3);       /* j = 8*(i1/5) */           
;----------------------------------------------------------------------
        LD        #6554,16,A            ; |770| 
        LD        *SP(102),T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |770| 
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #3,*SP(0)             ; |770| 
        ;CALLD     #_shl              ; |770| 
        ;NOP
        ;SFTA      A,-16,A               ; |770| 
        SFTA       A,-13
        
        STLM      A,AR5

;----------------------------------------------------------------------
; 776 | ps0 = ps;                                                              
;----------------------------------------------------------------------
        LD        *SP(120),A
        STL       A,*SP(126)
;----------------------------------------------------------------------
; 777 | alp0 = L_mult(alp, _1_4);                                              
; 779 | sq = -1;                                                               
; 780 | alp = 1;                                                               
;----------------------------------------------------------------------
        ;SSBX      FRCT
        ;SSBX      OVM
        MPY       *(AR6),#8192,A        ; |777| 
        DST       A,*SP(124)            ; |777| 

;----------------------------------------------------------------------
; 784 | p0 = ptr_rri2i3_i4 + mult(i0, 6554);                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #6554,16,A            ; |784| 
        ;SSBX      SXM
        ;SSBX      OVM
        MVMD      AR1,T
        MPYA      A                     ; |784| 
        LD        *SP(110),B
        RSBX      OVM
        SFTA      A,-16,A               ; |784| 
        ADD       B,A                   ; |784| 
        STLM      A,AR2

;----------------------------------------------------------------------
; 785 | p1 = rri0i2 + i1_offset;                                               
;----------------------------------------------------------------------
        LD        *SP(101),A
        ADD       *(AR5),A
        STLM      A,AR0
        NOP

;----------------------------------------------------------------------
; 786 | p2 = rri2i2;                                                           
;----------------------------------------------------------------------
        MVDK      *SP(97),*(AR3)
;----------------------------------------------------------------------
; 787 | p3 = tmp_vect;                                                         
; 789 | for (i3=2; i3<L_SUBFR; i3+=STEP)                                       
;----------------------------------------------------------------------
        MVMM      SP,AR4
        STM       #7,BRC
        MAR       *+AR4(#82)
        RPTB      L62-1
L61:    
;----------------------------------------------------------------------
; 792 | s = L_mult(*p0, _1_4);         p0 += NB_POS;                           
;----------------------------------------------------------------------
        ;SSBX      OVM
        ;NOP
        MPY       *AR2,#8192,A          ; |792| 
        MAR       *+AR2(#8)
;----------------------------------------------------------------------
; 793 | s = L_mac(s, *p1++, _1_4);                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |793| 
        LD        #8192,B
        LD        *AR0+,T
        ;SFTA      A,-8                  ; |793| 
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |793| 

;----------------------------------------------------------------------
; 794 | s = L_mac(s, *p2++, _1_8);                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |794| 
        LD        *AR3+,T
        LD        #4096,B
        SSBX      OVM
        ;SFTA      A,-8                  ; |794| 
        MAC       *(BL), A              ; |794| 

;----------------------------------------------------------------------
; 795 | *p3++ = round(s);                                                      
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |795| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |795| 
        ADD       #1,#15,A,A            ; |795| 
        STH       A,*AR4+               ; |795| 
        ; loop ends ; |796| 
L62:    
;----------------------------------------------------------------------
; 800 | p0 = ptr_rri1i3_i4 + mult(i0, 6554);                                   
;----------------------------------------------------------------------
        ;RSBX      OVM
        MVMD      AR1,T
        LD        #6554,16,A            ; |800| 
        ;SSBX      OVM
        LD        *SP(109),B
        MPYA      A                     ; |800| 
        ;RSBX      OVM
        SFTA      A,-16,A               ; |800| 
        ADD       B,A                   ; |800| 
        STL       A,*SP(127)

;----------------------------------------------------------------------
; 801 | p1 = rri0i1 + i1_offset;                                               
;----------------------------------------------------------------------
        LD        *SP(100),B
        LDM       AR5,A
        ADD       B,A                   ; |801| 
        SUB       #1,A,A                ; |801| 
        STL       A,*FP(128)
;----------------------------------------------------------------------
; 802 | p2 = rri1i1;                                                           
;----------------------------------------------------------------------
        LD        *SP(96),A
        SUB       #1,A,A                ; |802| 
        STL       A,*FP(129)
;----------------------------------------------------------------------
; 803 | p3 = rri1i2;                                                           
;----------------------------------------------------------------------
        LD        *SP(90),A
        ADD       #1,A,A
        STL       A,*FP(130)
        LD        *SP(90),A
        ADD       #2,A,A
        STLM      A,AR5
        NOP
        MVDK      *SP(104),*(AR4)
        STM       #-1,BK
        STM       #1,AR3
;----------------------------------------------------------------------
; 805 | for (i2=1; i2<L_SUBFR; i2+=STEP)                                       
;----------------------------------------------------------------------
        LD        #1,A
        STL       A,*SP(105)
        LD        #7,A
        STL       A,*SP(98)
L63:    
;----------------------------------------------------------------------
; 807 | ps1 = add(ps0, dn[i2]);         /* index increment = STEP */           
;----------------------------------------------------------------------
        LD        *SP(126),A
        LD        *(AL),16,A            ; |807| 
        ;SSBX      OVM
        MVDK      *FP(130),*(AR2)
        ADD       *AR2,16,A,A           ; |807| 
        SFTA      A,-16,A               ; |807| 
        STL       A,*SP(122)
;----------------------------------------------------------------------
; 810 | alp1 = L_mac(alp0, *p0, _1_8);       p0 += NB_POS;                     
; 811 | alp1 = L_mac(alp1, *p1++, _1_8);                                       
; 812 | alp1 = L_mac(alp1, *p2++, _1_16);                                      
;----------------------------------------------------------------------
        MVDK      *SP(127),*(AR2)
        ;RSBX      OVM
        LD        #4096,B
        LD        *AR2,T
        DLD       *SP(124),A
        ;ORM       #2,*(PMST)
        ;SSBX      OVM
        ;ORM       #2,*(PMST)
        MAC       *(BL), A              ; |810| 
        ;RSBX      OVM
        MVDK      *FP(128),*(AR2)
        ;SFTA      A,8                   ; |810| 
        LD        #4096,B
        LD        *+AR2(1),T
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |810| 
        MAC       *(BL), A              ; |810| 
        MVKD      *(AR2),*FP(128)
        ;RSBX      OVM
        MVDK      *FP(129),*(AR2)
        ;SFTA      A,8                   ; |810| 
        LD        *+AR2(1),T
        LD        #2048,B
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |810| 
        MAC       *(BL), A              ; |810| 
        DST       A,*FP(132)            ; |810| 
        MVKD      *(AR2),*FP(129)
;----------------------------------------------------------------------
; 816 | p4 = tmp_vect;                                                         
;----------------------------------------------------------------------
        MVMM      SP,AR6
        MAR       *+AR6(#82)
;----------------------------------------------------------------------
; 818 | for (i3=2; i3<L_SUBFR; i3+=STEP)                                       
; 820 |   ps2 = add(ps1, dn[i3]);       /* index increment = STEP */           
;----------------------------------------------------------------------
        STM       #2,AR0
        STM       #7,BRC
        RPTB      L66-1
L64:    
;----------------------------------------------------------------------
; 823 | alp2 = L_mac(alp1, *p3++, _1_8);                                       
; 824 | alp2 = L_mac(alp2, *p4++, _1_2);                                       
; 826 | sq2 = mult(ps2, ps2);                                                  
; 827 | alp_16 = round(alp2);                                                  
; 829 | s = L_msu(L_mult(alp,sq2),sq,alp_16);                                  
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *AR4+,T
        LD        #4096,B
        DLD       *FP(132),A
        ;SSBX      OVM
        MAC       *(BL), A              ; |823| 
        ;RSBX      OVM
        LD        *AR6+,T
        LD        #16384,B
        ;SFTA      A,8                   ; |823| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |823| 
        MAC       *(BL), A              ; |823| 

;----------------------------------------------------------------------
; 830 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |830| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |830| 
        ADD       #1,#15,A,A            ; |830| 
        SFTA      A,-16,A               ; |830| 
        STLM      A,AR2
        ;RSBX      OVM
        LD        *SP(122),A
        LD        *(AL),16,A            ; |830| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR5,16,A,A           ; |830| 
        ;RSBX      OVM
        SFTA      A,-16,B               ; |830| 
        LD        *(BL),16,A            ; |830| 
        STLM      B,T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |830| 
        SFTA      A,-16,A               ; |830| 
        STLM      A,T
        MPY       *(AR3),B              ; |830| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      B,8                   ; |830| 
        MVMD      BK,T
        ;SFTA      B,-8                  ; |830| 
        ;SSBX      OVM
        MAS       *(AR2), B             ; |830| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      B,8                   ; |830| 
        ;SFTA      B,-8                  ; |830| 
        BC        L65,BLEQ              ; |830| 

;----------------------------------------------------------------------
; 832 | sq = sq2;                                                              
;----------------------------------------------------------------------
        STLM      A,BK

;----------------------------------------------------------------------
; 833 | alp = alp_16;                                                          
;----------------------------------------------------------------------
        MVMM      AR2,AR3

;----------------------------------------------------------------------
; 834 | ix = i2;                                                               
;----------------------------------------------------------------------
        LD        *SP(105),A
        STL       A,*SP(118)

;----------------------------------------------------------------------
; 835 | iy = i3;                                                               
;----------------------------------------------------------------------
        MVKD      *(AR0),*SP(119)
L65:    
        MAR       *+AR0(#5)
        MAR       *+AR5(#5)
L66:    
;**  	-----------------------    U$213 -= 40;
;** 838	-----------------------    U$206 += 5;
;** 838	-----------------------    i2 += 5;
;** 810	-----------------------    p0 += 8;
;** 838	-----------------------    if ( (--L$19) != (-1) ) goto g70;
        MAR       *+AR5(#-40)

        ;RSBX      OVM
        LD        *FP(130),A
        ADD       #5,A
        STL       A,*FP(130)
        LD        *SP(105),A
        ADD       #5,A
        STL       A,*SP(105)

        LD        *SP(127),A
        ADD       #8,A
        STL       A,*SP(127)

;----------------------------------------------------------------------
; 844 | s = L_msu(L_mult(alpk,sq),psk,alp);                                    
;----------------------------------------------------------------------
        LD        *SP(98),A
        SUB       #1,A
        STLM      A,AR2
        NOP
        NOP
        BANZD     L63,*AR2(1)            
        NOP
        STL       A,*SP(98)

;----------------------------------------------------------------------
; 845 | if (s > 0)                                                             
;----------------------------------------------------------------------
        ;SSBX      OVM
        MVMD      BK,T
        LD        *SP(113),A
        MPY       *(AL),A               ; |845| 
        ;RSBX      OVM
        LD        *SP(112),T
        ;SFTA      A,8                   ; |845| 
        ;SSBX      OVM
        ;SFTA      A,-8                  ; |845| 
        MAS       *(AR3), A             ; |845| 
        ;RSBX      OVM
        ;NOP
        ;SFTA      A,8                   ; |845| 
        ;SFTA      A,-8                  ; |845| 
        BC        L67,ALEQ              ; |845| 

;----------------------------------------------------------------------
; 847 | psk = sq;                                                              
;----------------------------------------------------------------------
        MVKD      *(BK),*SP(112)

;----------------------------------------------------------------------
; 848 | alpk = alp;                                                            
;----------------------------------------------------------------------
        MVKD      *(AR3),*SP(113)

;----------------------------------------------------------------------
; 849 | ip3 = i0;                                                              
;----------------------------------------------------------------------
        MVKD      *(AR1),*SP(117)

;----------------------------------------------------------------------
; 850 | ip0 = i1;                                                              
;----------------------------------------------------------------------
        LD        *SP(102),A
        STL       A,*SP(114)

;----------------------------------------------------------------------
; 851 | ip1 = ix;                                                              
;----------------------------------------------------------------------
        LD        *SP(118),A
        STL       A,*SP(115)

;----------------------------------------------------------------------
; 852 | ip2 = iy;                                                              
;----------------------------------------------------------------------
        LD        *SP(119),A
        STL       A,*SP(116)
L67:    
;----------------------------------------------------------------------
; 855 | ptr_rri0i3_i4 = rri0i4;                                                
;----------------------------------------------------------------------
        LD        *SP(103),A
        STL       A,*SP(108)

;----------------------------------------------------------------------
; 856 | ptr_rri1i3_i4 = rri1i4;                                                
;----------------------------------------------------------------------
        LD        *SP(106),A
        STL       A,*SP(109)

;----------------------------------------------------------------------
; 857 | ptr_rri2i3_i4 = rri2i4;                                                
;----------------------------------------------------------------------
        LD        *SP(107),A
        STL       A,*SP(110)

;----------------------------------------------------------------------
; 858 | ptr_rri3i3_i4 = rri4i4;                                                
;----------------------------------------------------------------------
        LD        *SP(99),A
        STL       A,*SP(111)

        LD        *SP(121),A
        ADD       #1,A
        STL       A,*SP(121)
        LD        *(AL),A               ; |860| 
        SUB       #5,A,A                ; |860| 
        BC        L41,ALT               ; |860| 

;----------------------------------------------------------------------
; 865 | i0 = sign_dn[ip0];                                                     
;----------------------------------------------------------------------
        LDM       SP,A
        LD        *SP(114),B
        ADD       #2,A
        ADD       B,A                   ; |865| 
        STLM      A,AR1
        NOP
        NOP
        LD        *AR1,A
        STL       A,*SP(98)

;----------------------------------------------------------------------
; 866 | i1 = sign_dn[ip1];                                                     
;----------------------------------------------------------------------
        LD        *SP(115),B
        LDM       SP,A
        ADD       #2,A
        ADD       B,A                   ; |866| 
        STLM      A,AR1
        NOP
        NOP
        LD        *AR1,A
        STL       A,*SP(102)

;----------------------------------------------------------------------
; 867 | i2 = sign_dn[ip2];                                                     
;----------------------------------------------------------------------
        LD        *SP(116),B
        LDM       SP,A
        ADD       #2,A
        ADD       B,A                   ; |867| 
        STLM      A,AR1
        NOP
        NOP
        MVDK      *AR1,*(AR1)

;----------------------------------------------------------------------
; 868 | i3 = sign_dn[ip3];                                                     
; 873 | for(i=0; i<L_SUBFR; i++) {                                             
;----------------------------------------------------------------------
        LDM       SP,A
        LD        *SP(117),B
        ADD       #2,A
        ADD       B,A                   ; |868| 
        STLM      A,AR2
        NOP
        NOP
        MVDK      *AR2,*(AR6)
        MVDK      *SP(93),*(AR2)
        RPT       #39
L68:    
;----------------------------------------------------------------------
; 874 | cod[i] = 0;                                                            
;----------------------------------------------------------------------
        ST        #0,*AR2+              ; |874| 
L69:    
;----------------------------------------------------------------------
; 877 | cod[ip0] = shr(i0, 2);         /* From Q15 to Q13 */                   
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;ST        #2,*SP(0)             ; |877| 
        LD        *SP(98),A
        ;CALL      #_crshft              ; |877| 
        SFTA      A,-2
        
        ;RSBX      OVM
        STLM      A,AR3
        LD        *SP(93),B
        LD        *SP(114),A
        ADD       A,B                   ; |877| 
        STLM      B,AR2
        NOP
        MVKD      *(AR3),*AR2

;----------------------------------------------------------------------
; 878 | cod[ip1] = shr(i1, 2);                                                 
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;ST        #2,*SP(0)             ; |878| 
        LD        *SP(102),A
        ;CALL      #_crshft              ; |878| 
        SFTA      A,-2
        
        STLM      A,AR3
        LD        *SP(115),A
        ;RSBX      OVM
        LD        *SP(93),B
        ADD       A,B                   ; |878| 
        STLM      B,AR2
        NOP
        MVKD      *(AR3),*AR2

;----------------------------------------------------------------------
; 879 | cod[ip2] = shr(i2, 2);                                                 
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;ST        #2,*SP(0)             ; |879| 
        ;CALLD     #_crshft              ; |879| 
        ;NOP
        LD       *(AR1),A
        SFTA      A,-2
        
        STLM      A,AR3
        LD        *SP(116),A
        ;RSBX      OVM
        LD        *SP(93),B
        ADD       A,B                   ; |879| 
        STLM      B,AR2
        NOP
        MVKD      *(AR3),*AR2

;----------------------------------------------------------------------
; 880 | cod[ip3] = shr(i3, 2);                                                 
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;ST        #2,*SP(0)             ; |880| 
        ;CALLD     #_crshft              ; |880| 
        ;NOP
        ;LDM       AR6,A
        LD         *(AR6),A
        SFTA       A,-2
        
        STLM      A,AR3
        LD        *SP(117),A
        ;RSBX      OVM
        LD        *SP(93),B
        ADD       A,B                   ; |880| 
        STLM      B,AR2
        NOP
        MVKD      *(AR3),*AR2

;----------------------------------------------------------------------
; 884 | for (i = 0; i < ip0; i++) y[i] = 0;                                    
;----------------------------------------------------------------------
        SSBX      SXM
        NOP
        LD        *SP(114),A
        BC        L71,ALEQ              ; |884| 

        LD        *SP(114),A
        SUB       #1,A,A
        STLM      A,BRC
        MVDK      *SP(92),*(AR2)
        RPTB      L71-1
L70:    
        ST        #0,*AR2+              ; |884| 
L71:    
;----------------------------------------------------------------------
; 886 | if(i0 > 0)                                                             
; 887 |   for(i=ip0, j=0; i<L_SUBFR; i++, j++) y[i] = h[j];                    
; 888 | else                                                                   
;----------------------------------------------------------------------
        LD        *SP(98),A
        BC        L74,AGT               ; |886| 

;----------------------------------------------------------------------
; 889 | for(i=ip0, j=0; i<L_SUBFR; i++, j++) y[i] = negate(h[j]);              
;----------------------------------------------------------------------
        LD        *SP(114),A
        SUB       #40,A,A               ; |889| 
        BC        L76,AGEQ              ; |889| 

        LD        *SP(92),B
        LD        *SP(114),A
        ADD       *(BL),A
        STLM      A,AR3
        LD        *SP(114),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR2)
        RPTB      L73-1
L72:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2+,16,A            ; |889| 
        ;SSBX      OVM
        ;NOP
        NEG       A,A                   ; |889| 
        STH       A,*AR3+               ; |889| 
L73:    
        B         L76                   ; |889| 
L74:    
        LD        *SP(114),A
        SUB       #40,A,A               ; |887| 
        BC        L76,AGEQ              ; |887| 

        LD        *SP(92),B
        LD        *SP(114),A
        ADD       *(BL),A
        STLM      A,AR3
        LD        *SP(114),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR2)
        RPTB      L76-1
L75:    
        MVDD      *AR2+,*AR3+           ; |887| 
L76:    
;----------------------------------------------------------------------
; 891 | if(i1 > 0)                                                             
; 892 |   for(i=ip1, j=0; i<L_SUBFR; i++, j++) y[i] = add(y[i], h[j]);         
; 893 | else                                                                   
;----------------------------------------------------------------------
        LD        *SP(102),A
        BC        L79,AGT               ; |891| 

;----------------------------------------------------------------------
; 894 | for(i=ip1, j=0; i<L_SUBFR; i++, j++) y[i] = sub(y[i], h[j]);           
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(115),A
        SUB       #40,A,A               ; |894| 
        BC        L81,AGEQ              ; |894| 

        LD        *SP(92),B
        LD        *SP(115),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(115),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L78-1
L77:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |894| 
        ;SSBX      OVM
        ;NOP
        SUB       *AR3+,16,A,A          ; |894| 
        SFTA      A,-16,A               ; |894| 
        STL       A,*AR2+
L78:    
        B         L81                   ; |894| 

L79:    
        ;RSBX      OVM
        LD        *SP(115),A
        SUB       #40,A,A               ; |892| 
        BC        L81,AGEQ              ; |892| 

        LD        *SP(92),B
        LD        *SP(115),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(115),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L81-1
L80:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |892| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR3+,16,A,A          ; |892| 
        SFTA      A,-16,A               ; |892| 
        STL       A,*AR2+
L81:    
;----------------------------------------------------------------------
; 896 | if(i2 > 0)                                                             
; 897 |   for(i=ip2, j=0; i<L_SUBFR; i++, j++) y[i] = add(y[i], h[j]);         
; 898 | else                                                                   
;----------------------------------------------------------------------
        LD        *(AR1),A              ; |896| 
        BC        L84,AGT               ; |896| 

;----------------------------------------------------------------------
; 899 | for(i=ip2, j=0; i<L_SUBFR; i++, j++) y[i] = sub(y[i], h[j]);           
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(116),A
        SUB       #40,A,A               ; |899| 
        BC        L86,AGEQ              ; |899| 

        LD        *SP(92),B
        LD        *SP(116),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(116),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L83-1
L82:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |899| 
        ;SSBX      OVM
        ;NOP
        SUB       *AR3+,16,A,A          ; |899| 
        SFTA      A,-16,A               ; |899| 
        STL       A,*AR2+
L83:    

        B         L86                   ; |899| 
        ; branch occurs ; |899| 
L84:    

        ;RSBX      OVM
        LD        *SP(116),A
        SUB       #40,A,A               ; |897| 
        BC        L86,AGEQ              ; |897| 

        LD        *SP(92),B
        LD        *SP(116),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(116),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L86-1

L85:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |897| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR3+,16,A,A          ; |897| 
        SFTA      A,-16,A               ; |897| 
        STL       A,*AR2+
        
L86:    

;----------------------------------------------------------------------
; 901 | if(i3 > 0)                                                             
; 902 |   for(i=ip3, j=0; i<L_SUBFR; i++, j++) y[i] = add(y[i], h[j]);         
; 903 | else                                                                   
;----------------------------------------------------------------------
        LD        *(AR6),A              ; |901| 
        BC        L89,AGT               ; |901| 

;----------------------------------------------------------------------
; 904 | for(i=ip3, j=0; i<L_SUBFR; i++, j++) y[i] = sub(y[i], h[j]);           
; 908 | i = 0;                                                                 
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(117),A
        SUB       #40,A,A               ; |904| 
        BC        L91,AGEQ              ; |904| 

        LD        *SP(92),B
        LD        *SP(117),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(117),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L88-1

L87:    
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |904| 
        ;SSBX      OVM
        ;NOP
        SUB       *AR3+,16,A,A          ; |904| 
        SFTA      A,-16,A               ; |904| 
        STL       A,*AR2+
        ; loop ends ; |904| 
L88:    

        B         L91                   ; |904| 

L89:    
;**	-----------------------g118:
;** 902	-----------------------    if ( ip3 >= 40 ) goto g122;

        ;RSBX      OVM
        LD        *SP(117),A
        SUB       #40,A,A               ; |902| 
        BC        L91,AGEQ              ; |902| 
        ; branch occurs ; |902| 
;**  	-----------------------    #pragma MUST_ITERATE(1, 4294967295, 1)
;**  	-----------------------    #pragma LOOP_FLAGS(4096u)
;**  	-----------------------    U$258 = &y[ip3];
;**  	-----------------------    U$266 = h;
;**	-----------------------g121:
;**  	-----------------------    L$30 = 39-ip3;
;**	-----------------------g129:
        LD        *SP(92),B
        LD        *SP(117),A
        ADD       *(BL),A
        STLM      A,AR2
        LD        *SP(117),B
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        MVDK      *SP(94),*(AR3)
        RPTB      L91-1
        ; loop starts
L90:    
;** 902	-----------------------    A$19 = _sadd(*U$258, *U$266++);
;** 902	-----------------------    *U$258++ = A$19;
;** 902	-----------------------    if ( --L$30 != -1 ) goto g129;
        ;RSBX      OVM
        ;NOP
        LD        *AR2,16,A             ; |902| 
        ;SSBX      OVM
        ;NOP
        ADD       *AR3+,16,A,A          ; |902| 
        SFTA      A,-16,A               ; |902| 
        STL       A,*AR2+
        ; loop ends ; |902| 
L91:    
;----------------------------------------------------------------------
; 909 | if(i0 > 0) i = add(i, 1);                                              
;----------------------------------------------------------------------
        LD        *SP(98),A
        BC        L92,ALEQ              ; |909| 
        ; branch occurs ; |909| 
        ;RSBX      OVM
        ;NOP
        LD        #0,16,A               ; |909| 
        ;SSBX      OVM
        ;NOP
        ADD       #1,16,A,A             ; |909| 
        BD        L93                   ; |909| 
        NOP
        SFTA      A,-16,A               ; |909| 
        ; branch occurs ; |909| 
L92:    
        LD        #0,A
L93:    
;** 909	-----------------------    if ( i1 <= 0 ) goto g124;
        LD        *SP(102),B
        BC        L94,BLEQ              ; |909| 
        ; branch occurs ; |909| 
;** 910	-----------------------    i = _sadd(i, 2);

;----------------------------------------------------------------------
; 910 | if(i1 > 0) i = add(i, 2);                                              
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *(AL),16,A            ; |910| 
        ;SSBX      OVM
        ;NOP
        ADD       #2,16,A,A             ; |910| 
        SFTA      A,-16,A               ; |910| 
L94:    
;**	-----------------------g124:
;** 911	-----------------------    if ( i2 <= 0 ) goto g126;

;----------------------------------------------------------------------
; 911 | if(i2 > 0) i = add(i, 4);                                              
;----------------------------------------------------------------------
        LD        *(AR1),B              ; |911| 
        BC        L95,BLEQ              ; |911| 
        ; branch occurs ; |911| 
;** 911	-----------------------    i = _sadd(i, 4);
        ;RSBX      OVM
        LD        *(AL),16,A            ; |911| 
        ;SSBX      OVM
        ;NOP
        ADD       #4,16,A,A             ; |911| 
        SFTA      A,-16,A               ; |911| 
L95:    
;**	-----------------------g126:
;** 912	-----------------------    if ( i3 <= 0 ) goto g128;

;----------------------------------------------------------------------
; 912 | if(i3 > 0) i = add(i, 8);                                              
;----------------------------------------------------------------------
        LD        *(AR6),B              ; |912| 
        BC        L96,BLEQ              ; |912| 
        ; branch occurs ; |912| 
;** 912	-----------------------    i = _sadd(i, 8);
        ;RSBX      OVM
        LD        *(AL),16,A            ; |912| 
        ;SSBX      OVM
        ;NOP
        ADD       #8,16,A,A             ; |912| 
        SFTA      A,-16,A               ; |912| 
L96:    
;**	-----------------------g128:
;** 913	-----------------------    *sign = i;
;** 915	-----------------------    ip0 = _smpy(ip0, 6554);
;** 916	-----------------------    ip1 = _smpy(ip1, 6554);
;** 917	-----------------------    ip2 = _smpy(ip2, 6554);
;** 919	-----------------------    C$1 = _smpy(ip3, 6554);
;** 919	-----------------------    j = _sadd(C$1, clshft(C$1, 2));
;** 920	-----------------------    j = _ssub(ip3, _sadd(j, 3));
;** 921	-----------------------    ip3 = _sadd(clshft(C$1, 1), j);
;** 923	-----------------------    i = _sadd(ip0, clshft(ip1, 3));
;** 924	-----------------------    i = _sadd(i, clshft(ip2, 6));
;** 925	-----------------------    i = _sadd(i, clshft(ip3, 9));
;** 927	-----------------------    return i;

;----------------------------------------------------------------------
; 913 | *sign = i;                                                             
;----------------------------------------------------------------------
        MVDK      *SP(91),*(AR1)
        STL       A,*AR1

;----------------------------------------------------------------------
; 915 | ip0 = mult(ip0, 6554);         /* ip0/5 */                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;SSBX      FRCT
        LD        #6554,16,A            ; |915| 
        LD        *SP(114),T
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |915| 
        SFTA      A,-16,A               ; |915| 
        STL       A,*SP(114)

;----------------------------------------------------------------------
; 916 | ip1 = mult(ip1, 6554);         /* ip1/5 */                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *SP(115),T
        LD        #6554,16,A            ; |916| 
        ;SSBX      OVM
        ;NOP
        MPYA      A                     ; |916| 
        SFTA      A,-16,A               ; |916| 
        STL       A,*SP(115)

;----------------------------------------------------------------------
; 917 | ip2 = mult(ip2, 6554);         /* ip2/5 */                             
; 918 | i   = mult(ip3, 6554);         /* ip3/5 */                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #6554,16,A            ; |917| 
        ;SSBX      OVM
        LD        *SP(116),T
        NOP
        MPYA      A                     ; |917| 
        SFTA      A,-16,A               ; |917| 
        STL       A,*SP(116)

;----------------------------------------------------------------------
; 919 | j   = add(i, shl(i, 2));       /* j = i*5 */                           
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;NOP
        LD        #6554,16,A            ; |919| 
        LD        *SP(117),T
        ;SSBX      OVM
        ;ST        #2,*SP(0)             ; |919| 
        MPYA      A                     ; |919| 
        ;RSBX      FRCT
        ;RSBX      OVM
        
        SFTA      A,-16,A               ; |919| 
        STLM      A,AR6        ; ****
        ;CALLD     #_shl              ; |919| 
        SFTA      A,2  ; ****
        
        ;STLM      A,AR6
        ;NOP
        ; call occurs [#_shl] ; |919| 
        ;RSBX      OVM
        ;SSBX      SXM
        LD        *(AR6),16,B           ; |919| 
        ;SSBX      OVM
        ADD       *(AL),16,B,A          ; |919| 
        SFTA      A,-16,A               ; |919| 
        STLM      A,AR1

;----------------------------------------------------------------------
; 920 | j   = sub(ip3, add(j, 3));     /* j= ip3%5 -3 */                       
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *(AR1),16,A           ; |920| 
        ;SSBX      OVM
        ;NOP
        ADD       #3,16,A,A             ; |920| 
        ;RSBX      OVM
        LD        *SP(117),B
        LD        *(BL),16,B            ; |920| 
        ;SSBX      OVM
        SFTA      A,-16,A               ; |920| 
        SUB       *(AL),16,B,A          ; |920| 
        SFTA      A,-16,A               ; |920| 
        STLM      A,AR1

;----------------------------------------------------------------------
; 921 | ip3 = add(shl(i, 1), j);                                               
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #1,*SP(0)             ; |921| 
        ;CALLD     #_shl              ; |921| 
        LDM       AR6,A ; ****
        SFTA      A,1
        ;NOP
        ;LDM       AR6,A
        ; call occurs [#_shl] ; |921| 
        RSBX      OVM
        SSBX      SXM
        LD        *(AL),16,A            ; |921| 
        SSBX      OVM
        ADD       *(AR1),16,A,A         ; |921| 
        SFTA      A,-16,A               ; |921| 
        STL       A,*SP(117)

;----------------------------------------------------------------------
; 923 | i = add(ip0, shl(ip1, 3));                                             
;----------------------------------------------------------------------
        ;RSBX      FRCT
        ;ST        #3,*SP(0)             ; |923| 
        ;RSBX      OVM
        LD        *SP(115),A
        ;CALL      #_shl              ; |923| 
        SFTA       A,3
        
        ;RSBX      OVM
        ;SSBX      SXM
        LD        *SP(114),B
        LD        *(BL),16,B            ; |923| 
        ;SSBX      OVM
        ADD       *(AL),16,B,A          ; |923| 
        SFTA      A,-16,A               ; |923| 
        STLM      A,AR1

;----------------------------------------------------------------------
; 924 | i = add(i  , shl(ip2, 6));                                             
;----------------------------------------------------------------------
        LD        *SP(116),A
        ;RSBX      FRCT
        ;RSBX      OVM
        ;ST        #6,*SP(0)             ; |924| 
        ;CALL      #_shl              ; |924| 
        SFTA      A,6
        
        ;SSBX      SXM
        ;RSBX      OVM
        LD        *(AR1),16,B           ; |924| 
        ;SSBX      OVM
        ADD       *(AL),16,B,A          ; |924| 
        SFTA      A,-16,A               ; |924| 
        STLM      A,AR1

;----------------------------------------------------------------------
; 925 | i = add(i  , shl(ip3, 9));                                             
;----------------------------------------------------------------------
        ;RSBX      OVM
        ;RSBX      FRCT
        ;ST        #9,*SP(0)             ; |925| 
        LD        *SP(117),A
        ;CALL      #_shl              ; |925| 
        SFTA      A,9
  
        ;RSBX      OVM
        ;SSBX      SXM
        LD        *(AR1),16,B           ; |925| 
        ;SSBX      OVM
        ADD       *(AL),16,B,A          ; |925| 
        SFTA      A,-16,A               ; |925| 

;----------------------------------------------------------------------
; 927 | return i;                                                              
;----------------------------------------------------------------------

        ANDM      #-833,*(ST1)          ; |927| 
        ANDM      #-4,*(PMST)           ; |927| 
        RSBX      OVM
        ADDM      #134,*(SP)            ; |927| 
        NOP
        NOP
        POPM      FP                    ; |927| 
        POPM      AR6                   ; |927| 
        POPM      AR1                   
        RET       

	.sect	".text"
	.global	_ACELP_Code_A
;----------------------------------------------------------------------
;  46 | Word16  ACELP_Code_A(    /* (o)     :index of pulses positions    */   
;  47 | Word16 x[],            /* (i)     :Target vector                */     
;  48 | Word16 h[],            /* (i) Q12 :Inpulse response of filters  */     
;  49 | Word16 T0,             /* (i)     :Pitch lag                    */     
;  50 | Word16 pitch_sharp,    /* (i) Q14 :Last quantized pitch gain    */     
;  51 | Word16 code[],         /* (o) Q13 :Innovative codebook          */     
;  52 | Word16 y[],            /* (o) Q12 :Filtered innovative codebook */     
;  53 | Word16 *sign           /* (o)     :Signs of 4 pulses            */     
;  54 | )                                                                      
;----------------------------------------------------------------------

_ACELP_Code_A:

        PSHM      AR1
        ;RSBX      OVM
        PSHM      AR6
        PSHM      FP
        ADDM      #-668,*(SP)
        NOP
        NOP
        MVMM      SP,FP
;----------------------------------------------------------------------
;  56 | Word16 i, index, sharp;                                                
;  57 | Word16 Dn[L_SUBFR];                                                    
;  58 | Word16 rr[DIM_RR];                                                     
;----------------------------------------------------------------------
        STL       A,*FP(662)
        LD        *FP(677),A
        STL       A,*FP(663)
        LD        *FP(673),B
        LD        *FP(676),A
        STL       A,*FP(664)
        LD        *FP(675),A
        STL       B,*FP(666)
        STL       A,*FP(665)
        LD        *FP(674),A
        MVDK      *FP(672),*(AR6)

;----------------------------------------------------------------------
;  65 | sharp = shl(pitch_sharp, 1);          /* From Q14 to Q15 */            
;----------------------------------------------------------------------
        SSBX       OVM
        SSBX       SXM
        NOP
        SFTA       A,1
        ;RSBX      FRCT
        ;ST        #1,*SP(0)             ; |65| 
        ;CALL      #_shl              ; |65| 
        
        STLM      A,AR1

;----------------------------------------------------------------------
;  66 | if (T0 < L_SUBFR)                                                      
;  67 |    for (i = T0; i < L_SUBFR; i++)     /* h[i] += pitch_sharp*h[i-T0] */
;----------------------------------------------------------------------
        ;SSBX      SXM
        ;RSBX      OVM
        LD        *FP(666),A
        SUB       #40,A,A               ; |66| 
        BC        L98,AGEQ              ; |66| 

        MVMM      AR6,AR3
        LD        *FP(666),A
        LD        *FP(666),B
        ADD       *(AR3),A
        STLM      A,AR2
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        ;NOP
        SSBX      FRCT
        RPTB      L98-1
L97:    

;----------------------------------------------------------------------
;  68 | h[i] = add(h[i], mult(h[i-T0], sharp));                                
;----------------------------------------------------------------------
        ;RSBX      OVM
        LD        *(AR1),16,A           ; |68| 
        ;SSBX      FRCT
        ;SSBX      OVM
        ;NOP
        MPYA      *AR3+                 ; |68| 
        ;RSBX      OVM
        SFTA      B,-16,A               ; |68| 
        LD        *AR2,16,B             ; |68| 
        ;SSBX      OVM
        ADD       *(AL),16,B,A          ; |68| 
        SFTA      A,-16,A               ; |68| 
        STL       A,*AR2+    
L98:    

;----------------------------------------------------------------------
;  70 | Cor_h(h, rr);                                                          
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       SP,A
        RSBX      FRCT
        ADD       #46,A
        STL       A,*SP(0)
        CALLD     #_Cor_h               ; |70| 
        NOP
        LDM       AR6,A

;----------------------------------------------------------------------
;  76 | Cor_h_X(h, x, Dn);                                                     
;----------------------------------------------------------------------
        RSBX      OVM
        LD        *FP(662),A
        RSBX      FRCT
        STL       A,*SP(0)
        LDM       SP,A
        ADD       #6,A
        STL       A,*SP(1)
        CALLD     #_Cor_h_X             ; |76| 
        NOP
        LDM       AR6,A

;----------------------------------------------------------------------
;  82 | index = D4i40_17_fast(Dn, rr, h, code, y, sign);                       
;----------------------------------------------------------------------
        RSBX      OVM
        LDM       SP,A
        ADD       #46,A
        STL       A,*SP(0)
        MVKD      *(AR6),*SP(1)
        LD        *FP(665),A
        STL       A,*SP(2)
        LD        *FP(664),A
        STL       A,*SP(3)
        LD        *FP(663),A
        STL       A,*SP(4)
        RSBX      FRCT
        LDM       SP,A
        CALLD     #_D4i40_17_fast       ; |82| 
        ADD       #6,A
    
        STLM      A,AR4

;----------------------------------------------------------------------
;  89 | if(T0 < L_SUBFR)                                                       
;  90 |    for (i = T0; i < L_SUBFR; i++)    /* code[i] += pitch_sharp*code[i-T
;     | 0] */                                                                  
;----------------------------------------------------------------------
        SSBX      SXM
        RSBX      OVM
        LD        *FP(666),A
        SUB       #40,A,A               ; |89| 
        BC        L100,AGEQ             ; |89| 

        MVDK      *FP(665),*(AR2)
        LD        *FP(666),A
        LD        *FP(666),B
        ADD       *(AR2),A
        STLM      A,AR3
        LD        #39,A
        SUB       B,A
        STLM      A,BRC
        NOP
        RPTB      L100-1
        
L99:    

;----------------------------------------------------------------------
;  91 | code[i] = add(code[i], mult(code[i-T0], sharp));                       
;----------------------------------------------------------------------
        RSBX      OVM
        LD        *(AR1),16,A           ; |91| 
        SSBX      FRCT
        SSBX      OVM
        NOP
        MPYA      *AR2+                 ; |91| 
        RSBX      OVM
        SFTA      B,-16,A               ; |91| 
        LD        *AR3,16,B             ; |91| 
        SSBX      OVM
        ADD       *(AL),16,B,A          ; |91| 
        SFTA      A,-16,A               ; |91| 
        STL       A,*AR3+
        
L100:    
;----------------------------------------------------------------------
;  93 | return index;                                                          
;----------------------------------------------------------------------
        LDM       AR4,A

        ANDM      #-833,*(ST1)          ; |93| 
        ANDM      #-4,*(PMST)           ; |93| 
        RSBX      OVM
        ADDM      #668,*(SP)            ; |93| 
        NOP
        NOP
        POPM      FP                    ; |93| 
        POPM      AR6                   ; |93| 
        POPM      AR1                   ; |93| 
        RET       
        
;***************************************************************
;* UNDEFINED EXTERNAL REFERENCES                               *
;***************************************************************
	.global	_Cor_h_X
	.global	_shl
	.global	_shr

